(()=>{"use strict";var t,e,i,o={106:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});const o=i.p+"ce9b0dbc6e7c8db58f9f8e84a150cc88.png"},120:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=i(583),s=i(790),n=i(378),r=(i(709).default.gvec2,function(){function t(t,e,i,o,s,n,r,a){void 0===a&&(a=6),this.width=t,this.height=e,this.tileSize=i,this.scale=o,this.tiles=s,this.tilesColumns=n,this.tilesRow=r,this.player=null,this.currentLevel=null,this.levelsCount=a,this.levels=[],this.hud="",this.debugHud="",this.debugMode=!0}return t.prototype.init=function(){this.timer=new o.Timer(.06),this.gameSize=o.vec2(this.width,this.height),o.setCanvasFixedSize(this.gameSize),o.setCanvasMaxSize(this.gameSize),this.size=o.vec2(this.width/this.tileSize,this.height/this.tileSize),this.center=o.vec2(this.size.x/2,this.size.y/2),o.setCameraPos(this.center),o.setCameraScale(2*this.tileSize),this.player=new s.default(24,this.tileSize,this.scale,this.center),this.createLevels(),this.currentLevel.currentRoom.tileLayer.redraw(),this.player.position=o.vec2(Math.floor(this.currentLevel.currentRoom.center.x),Math.floor(this.currentLevel.currentRoom.center.y)),o.setCameraPos(this.player.position),this.debugHud="Player position: ".concat(this.player.position.x,", ").concat(this.player.position.y,"\n\n    Player gPosition: ").concat(this.player.gPosition.x,", ").concat(this.player.gPosition.y,"\n\n    Current level id: ").concat(this.currentLevel.id,"\n\n    Current room id, position: ").concat(this.currentLevel.currentRoom.id,", ").concat(this.currentLevel.currentRoom.position.x,", ").concat(this.currentLevel.currentRoom.position.y)},t.prototype.update=function(){this.timer.elapsed()&&(this.handleInput(),this.updateDebugHUD(),this.timer.set(.06))},t.prototype.render=function(){this.player.render()},t.prototype.renderPost=function(){this.debugMode&&this.drawDebugHUD(),this.currentLevel.renderMinimap()},t.prototype.drawDebugHUD=function(){var t=this.debugHud,e=o.WHITE,i=o.WHITE;o.drawTextScreen(t,o.vec2(100,100),15,i,null,e,"left","Arial","normal",1e3,0)},t.prototype.updateDebugHUD=function(){this.debugHud="Player position: ".concat(this.player.position.x,", ").concat(this.player.position.y,"\n\n    Player game position: ").concat(this.player.position.x,", ").concat(this.player.position.y,"\n\n    Current level: ").concat(this.currentLevel.id,"\n\n    Current room position: ").concat(this.currentLevel.currentRoom.position.x,", ").concat(this.currentLevel.currentRoom.position.y)},t.prototype.handleInput=function(){o.vec2(0,1),o.vec2(0,-1),o.vec2(-1,0),o.vec2(1,0);var t=o.keyDirection(),e=(o.vec2(t.x,-t.y),o.tileCollisionGetData(this.player.position.add(t)));if(e&&(console.log("Collision data at position, player position, direction: ",e,this.player.position.add(t),this.player.position,t),2==e)){console.log("Door found, switching room");var i=void 0;return 1==t.y?i=this.currentLevel.currentRoom.up:-1==t.y?i=this.currentLevel.currentRoom.down:-1==t.x?i=this.currentLevel.currentRoom.left:1==t.x&&(i=this.currentLevel.currentRoom.right),console.log("Door cardinal direction string: ",""),void(this.player.position=this.currentLevel.switchRoom(i))}e||this.player.move(t)},t.prototype.checkCollision=function(t,e){},t.prototype.createLevels=function(){for(var t=0;t<this.levelsCount;t++){var e=new n.default(t);this.levels.push(e)}this.currentLevel=this.levels[0]},t}());e.default=r},378:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=i(583),s=i(429),n=(i(709).default.gvec2,[[0,1,0,0,0],[0,1,2,0,0],[0,0,1,0,0],[0,0,1,3,0]]),r=[[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null]],a=function(){function t(t,e,i){void 0===e&&(e=6),void 0===i&&(i=n),this.id=t,this.roomsCount=e,this.rooms=[],this.roomsMap=r,this.levelLayout=i,this.currentRoom=null,this.init()}return t.prototype.init=function(){this.createRooms()},t.prototype.createRooms=function(){for(var t=0,e=0;e<this.levelLayout.length;e++)for(var i=0;i<this.levelLayout[e].length;i++){var n=this.levelLayout[e][i];if(n!=s.default.RoomTypes.EMPTY){var r=new s.default(t,o.vec2(i,e),n);t++,this.roomsMap[e][i]=r,this.rooms.push(r)}}for(e=0;e<this.levelLayout.length;e++)for(i=0;i<this.levelLayout[e].length;i++)null!=this.roomsMap[e][i]&&(r=this.roomsMap[e][i],e>0&&null!=this.roomsMap[e-1][i]&&(r.up=this.roomsMap[e-1][i],r.createDoor(r.up,"up")),e<this.levelLayout.length-1&&null!=this.roomsMap[e+1][i]&&(r.down=this.roomsMap[e+1][i],r.createDoor(r.down,"down")),i>0&&null!=this.roomsMap[e][i-1]&&(r.left=this.roomsMap[e][i-1],r.createDoor(r.left,"left")),i<this.levelLayout[e].length-1&&null!=this.roomsMap[e][i+1]&&(r.right=this.roomsMap[e][i+1],r.createDoor(r.right,"right")));for(e=0;e<this.levelLayout.length;e++)for(i=0;i<this.levelLayout[e].length;i++)this.levelLayout[e][i]==s.default.RoomTypes.START&&this.switchRoom(this.roomsMap[e][i])},t.prototype.createRoomDoor=function(t,e){console.log("Creating door for room at position: ",t.position," direction: ",e);var i=null;"up"==e?i=this.roomsMap[t.position.y-1][t.position.x]:"down"==e?i=this.roomsMap[t.position.y+1][t.position.x]:"left"==e?i=this.roomsMap[t.position.y][t.position.x-1]:"right"==e&&(i=this.roomsMap[t.position.y][t.position.x+1]),t.createDoor(i,e)},t.prototype.createDoors=function(t){console.log("In level.createDoors() for room at position: ",t,t.position);var e=t.position.add(o.vec2(0,-1)),i=t.position.add(o.vec2(0,1)),s=t.position.add(o.vec2(-1,0)),n=t.position.add(o.vec2(1,0));console.log("Adjacent rooms at up, down, left, right: ",this.roomsMap[e.y]?this.roomsMap[e.y][e.x]:"Out of bounds",this.roomsMap[i.y]?this.roomsMap[i.y][i.x]:"Out of bounds",this.roomsMap[s.y]?this.roomsMap[s.y][s.x]:"Out of bounds",this.roomsMap[n.y]?this.roomsMap[n.y][n.x]:"Out of bounds");var r=this.roomsMap[e.y]?this.roomsMap[e.y][e.x]:null,a=this.roomsMap[i.y]?this.roomsMap[i.y][i.x]:null,c=this.roomsMap[s.y]?this.roomsMap[s.y][s.x]:null,l=this.roomsMap[n.y]?this.roomsMap[n.y][n.x]:null;r&&(o.vec2(Math.floor(t.size.x/2),0),t.createDoor(this.roomsMap[e.y][e.x],"up")),a&&(o.vec2(Math.floor(t.size.x/2),t.size.y-1),t.createDoor(this.roomsMap[i.y][i.x],"down")),c&&(o.vec2(0,Math.floor(t.size.y/2)),t.createDoor(this.roomsMap[s.y][s.x],"left")),l&&(o.vec2(t.size.x-1,Math.floor(t.size.y/2)),t.createDoor(this.roomsMap[n.y][n.x],"right"))},t.prototype.renderMinimap=function(){var t,e=this.roomsMap,i=o.vec2(100,100),n=o.vec2(500,50);o.drawRect(n,i,o.GRAY,0,!0,!0);for(var r=0;r<e.length;r++)for(var a=0;a<e[r].length;a++)null!=e[r][a]&&(t=e[r][a].roomType==s.default.RoomTypes.START?o.YELLOW:e[r][a].roomType==s.default.RoomTypes.END?o.RED:o.WHITE,e[r][a]==this.currentRoom&&(t=o.GREEN),o.drawRect(n.add(o.vec2(10*a,10*r)),o.vec2(10,10),t,0,!0,!0))},t.prototype.switchRoom=function(t){t.position.add(o.vec2(0,-1)),t.position.add(o.vec2(0,1)),t.position.add(o.vec2(-1,0)),t.position.add(o.vec2(1,0));var e=this.currentRoom;if(console.log("Switching room from, to: ",e,t),this.currentRoom=t,this.currentRoom.tileLayer.redraw(),e){var i=o.vec2(0);return e.doorsMap.up&&(i=o.vec2(t.center.x,0)),e.doorsMap.down&&(i=o.vec2(t.center.x,t.size.y+2)),e.doorsMap.left&&(i=o.vec2(t.size.x-1,t.center.y)),e.doorsMap.right&&(i=o.vec2(0,t.center.y)),i}},t}();e.default=a},429:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var o,s=i(583),n=i(586),r=i(709).default.gvec2,a=[[1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1]];!function(t){t[t.EMPTY=0]="EMPTY",t[t.NORMAL=1]="NORMAL",t[t.START=2]="START",t[t.END=3]="END"}(o||(o={}));var c=function(){function t(t,e,i,n,c,l){void 0===i&&(i=o.EMPTY),void 0===n&&(n=a),void 0===c&&(c=8),void 0===l&&(l=s.vec2(11,9)),this.id=t,this.roomType=i,this.roomLayout=n,this.tileLayer=null,this.tileSize=c,this.size=l,this.center=null,this.doors=[],this.doorsMap={up:null,down:null,left:null,right:null},this.position=e,this.gPosition=r(e),this.up=null,this.down=null,this.left=null,this.right=null,this.init()}return t.prototype.init=function(){this.buildTileLayer(),this.center=s.vec2(this.size.x/2,this.size.y/2)},t.prototype.buildTileLayer=function(){var t=s.vec2();this.tileLayer=new s.TileCollisionLayer(t,this.size,new s.TileInfo(s.vec2(0),s.vec2(this.tileSize)));for(var e=0;e<this.roomLayout.length;e++)for(var i=0;i<this.roomLayout[e].length;i++){var o=this.roomLayout[e][i],n=s.vec2(i,e),r=o,a=void 0;switch(o){case 0:a=5;break;case 1:a=637;break;default:a=0}var c=new s.TileLayerData(a);this.tileLayer.setData(n,c),this.tileLayer.setCollisionData(n,r)}},t.prototype.createDoor=function(t,e){var i,o=new s.TileLayerData(444,0);switch(e){case"up":i=s.vec2(Math.floor(this.size.x/2),this.size.y);break;case"down":i=s.vec2(Math.floor(this.size.x/2),0);break;case"left":i=s.vec2(0,Math.floor(this.size.y/2));break;case"right":i=s.vec2(this.size.x-1,Math.floor(this.size.y/2))}this.tileLayer.setData(i,o),this.tileLayer.setCollisionData(i,2);var r=new n.default(i,this,t,e);this.doors.push(r),this.doorsMap[e]=r},t.RoomTypes=o,t}();e.default=c},583:(t,e,i)=>{i.r(e),i.d(e,{ASSERT:()=>_,BLACK:()=>$t,BLUE:()=>re,Box2dDistanceJoint:()=>lr,Box2dFrictionJoint:()=>br,Box2dGearJoint:()=>fr,Box2dJoint:()=>ar,Box2dKiematicObject:()=>yr,Box2dMotorJoint:()=>Sr,Box2dObject:()=>nr,Box2dPinJoint:()=>hr,Box2dPlugin:()=>wr,Box2dPrismaticJoint:()=>pr,Box2dPulleyJoint:()=>mr,Box2dRaycastResult:()=>rr,Box2dRevoluteJoint:()=>ur,Box2dRopeJoint:()=>dr,Box2dStaticObject:()=>gr,Box2dTargetJoint:()=>cr,Box2dWeldJoint:()=>xr,Box2dWheelJoint:()=>vr,CLEAR_BLACK:()=>Zt,CLEAR_WHITE:()=>Qt,CYAN:()=>ne,CanvasLayer:()=>js,Color:()=>Xt,EngineObject:()=>eo,FontImage:()=>Oo,GRAY:()=>te,GREEN:()=>se,LOG:()=>F,MAGENTA:()=>ce,Medal:()=>$s,NewgroundsMedal:()=>Wn,NewgroundsPlugin:()=>Nn,ORANGE:()=>ie,PI:()=>Z,PURPLE:()=>ae,Particle:()=>Us,ParticleEmitter:()=>Ns,PostProcessPlugin:()=>Un,RED:()=>ee,RandomGenerator:()=>It,Sound:()=>Cs,SoundInstance:()=>Ds,SoundWave:()=>Ls,TextureInfo:()=>co,TileCollisionLayer:()=>Ws,TileInfo:()=>ao,TileLayer:()=>ks,TileLayerData:()=>Is,Timer:()=>le,UIButton:()=>Zn,UICheckbox:()=>tr,UIObject:()=>Kn,UIScrollbar:()=>er,UISystemPlugin:()=>Xn,UIText:()=>Qn,UITile:()=>$n,UIVideo:()=>ir,Vector2:()=>Ut,WHITE:()=>Kt,YELLOW:()=>oe,ZzFXMusic:()=>Hn,abs:()=>tt,atan2:()=>ut,audioContext:()=>ws,audioDefaultSampleRate:()=>Ts,audioMasterGain:()=>Ss,box2d:()=>qn,box2dDebug:()=>or,box2dInit:()=>Tr,box2dSetDebug:()=>sr,cameraAngle:()=>be,cameraPos:()=>xe,cameraScale:()=>me,canvasClearColor:()=>we,canvasColorTiles:()=>Se,canvasFixedSize:()=>Ae,canvasMaxSize:()=>Te,canvasPixelated:()=>Ce,ceil:()=>it,clamp:()=>pt,combineCanvases:()=>Eo,cos:()=>ht,debug:()=>E,debugCircle:()=>I,debugClear:()=>U,debugLine:()=>k,debugOverlap:()=>W,debugOverlay:()=>P,debugPoint:()=>j,debugPoly:()=>z,debugRect:()=>J,debugSaveCanvas:()=>q,debugSaveDataURL:()=>Y,debugSaveText:()=>V,debugScreenshot:()=>H,debugShowErrors:()=>X,debugText:()=>N,debugVideoCaptureIsActive:()=>K,debugVideoCaptureStart:()=>Q,debugVideoCaptureStop:()=>$,distanceAngle:()=>bt,distanceWrap:()=>vt,drawCanvas:()=>pe,drawCanvas2D:()=>xo,drawCircle:()=>vo,drawContext:()=>ge,drawCount:()=>io,drawEllipse:()=>yo,drawLine:()=>po,drawLineList:()=>fo,drawNineSlice:()=>Cr,drawNineSliceScreen:()=>Ar,drawPoly:()=>go,drawRect:()=>ho,drawRectGradient:()=>uo,drawText:()=>bo,drawTextOverlay:()=>mo,drawTextScreen:()=>So,drawThreeSlice:()=>Dr,drawThreeSliceScreen:()=>Lr,drawTile:()=>lo,enablePhysicsSolver:()=>Fe,engineAddPlugin:()=>m,engineFontImage:()=>oo,engineInit:()=>S,engineName:()=>o,engineObjects:()=>a,engineObjectsCallback:()=>C,engineObjectsCollect:()=>A,engineObjectsDestroy:()=>T,engineObjectsRaycast:()=>L,engineObjectsUpdate:()=>w,engineVersion:()=>s,fetchJSON:()=>Rt,floor:()=>et,fontDefault:()=>Re,formatTime:()=>Dt,frame:()=>l,frameRate:()=>n,gamepadConnected:()=>ss,gamepadDirectionEmulateStick:()=>He,gamepadDpad:()=>os,gamepadIsDown:()=>Zo,gamepadPrimary:()=>Wo,gamepadStick:()=>is,gamepadWasPressed:()=>ts,gamepadWasReleased:()=>es,gamepadsEnable:()=>Ue,getCameraSize:()=>Do,getNoteFrequency:()=>Ps,getPaused:()=>f,glActiveTexture:()=>nn,glAdditive:()=>on,glAntialias:()=>un,glArrayBuffer:()=>rn,glBatchAdditive:()=>sn,glBatchCount:()=>hn,glCanvas:()=>Ys,glClearCanvas:()=>An,glColorData:()=>ln,glCompileShader:()=>Ln,glContext:()=>Xs,glCopyToContext:()=>Mn,glCreateProgram:()=>Dn,glCreateTexture:()=>Rn,glDeleteTexture:()=>En,glDraw:()=>_n,glDrawColoredPoints:()=>zn,glDrawOutlineTransform:()=>Bn,glDrawPoints:()=>Jn,glDrawPointsTransform:()=>Fn,glEnable:()=>Ge,glFlush:()=>Gn,glGeometryBuffer:()=>an,glPolyMode:()=>en,glPolyShader:()=>tn,glPositionData:()=>cn,glSetAntialias:()=>On,glSetTexture:()=>Cn,glSetTextureData:()=>Pn,glShader:()=>Zs,gravity:()=>We,headlessMode:()=>Pe,hsl:()=>qt,hypot:()=>at,inputClear:()=>Ho,inputClearKey:()=>Uo,inputPreventDefault:()=>ko,inputWASDEmulateDirection:()=>qe,isArray:()=>Gt,isColor:()=>Vt,isFullscreen:()=>Po,isIntersecting:()=>Ct,isNumber:()=>Et,isOverlapping:()=>At,isString:()=>Pt,isTouchDevice:()=>ns,isUsingGamepad:()=>jo,isVector2:()=>kt,keyDirection:()=>Xo,keyIsDown:()=>qo,keyWasPressed:()=>Vo,keyWasReleased:()=>Yo,lerp:()=>yt,lerpAngle:()=>mt,lerpWrap:()=>xt,log2:()=>ct,mainCanvas:()=>he,mainCanvasSize:()=>so,mainContext:()=>de,max:()=>nt,medalDisplaySize:()=>ai,medalDisplaySlideTime:()=>ri,medalDisplayTime:()=>ni,medals:()=>Hs,medalsInit:()=>Qs,medalsPreventUnlock:()=>ci,min:()=>st,mod:()=>ft,mouseDelta:()=>Bo,mouseDeltaScreen:()=>Jo,mouseInWindow:()=>Io,mouseIsDown:()=>Ko,mousePos:()=>_o,mousePosScreen:()=>Fo,mouseWasPressed:()=>Qo,mouseWasReleased:()=>$o,mouseWheel:()=>zo,nearestPowerOfTwo:()=>Tt,newgrounds:()=>In,objectDefaultAngleDamping:()=>ze,objectDefaultDamping:()=>Je,objectDefaultFriction:()=>je,objectDefaultMass:()=>Be,objectDefaultRestitution:()=>Ie,objectMaxSpeed:()=>ke,overlayCanvas:()=>ue,overlayCanvasPixelated:()=>Le,overlayContext:()=>fe,particleEmitRateScale:()=>Ne,paused:()=>u,percent:()=>gt,playSamples:()=>Gs,pointerLockExit:()=>ls,pointerLockIsActive:()=>hs,pointerLockRequest:()=>cs,postProcess:()=>jn,rand:()=>Mt,randBool:()=>_t,randColor:()=>zt,randInCircle:()=>Jt,randInt:()=>Ot,randSign:()=>Ft,randVec2:()=>Bt,rgb:()=>Ht,round:()=>ot,screenToWorld:()=>wo,screenToWorldDelta:()=>Ao,setBlendMode:()=>Ro,setCameraAngle:()=>hi,setCameraPos:()=>li,setCameraScale:()=>di,setCanvasClearColor:()=>fi,setCanvasColorTiles:()=>ui,setCanvasFixedSize:()=>gi,setCanvasMaxSize:()=>pi,setCanvasPixelated:()=>yi,setCursor:()=>Mo,setDebugKey:()=>to,setEnablePhysicsSolver:()=>Ci,setFontDefault:()=>bi,setGLEnable:()=>wi,setGamepadDirectionEmulateStick:()=>Fi,setGamepadsEnable:()=>_i,setGravity:()=>Mi,setHeadlessMode:()=>Si,setInputPreventDefault:()=>No,setInputWASDEmulateDirection:()=>Bi,setMedalDisplaySize:()=>Qi,setMedalDisplaySlideTime:()=>Ki,setMedalDisplayTime:()=>Xi,setMedalsPreventUnlock:()=>$i,setObjectDefaultAngleDamping:()=>Ri,setObjectDefaultDamping:()=>Di,setObjectDefaultFriction:()=>Pi,setObjectDefaultMass:()=>Li,setObjectDefaultRestitution:()=>Ei,setObjectMaxSpeed:()=>Gi,setOverlayCanvasPixelated:()=>vi,setParticleEmitRateScale:()=>Oi,setPaused:()=>p,setShowSplashScreen:()=>mi,setShowWatermark:()=>Zi,setSoundDefaultRange:()=>Vi,setSoundDefaultTaper:()=>Yi,setSoundEnable:()=>Hi,setSoundVolume:()=>qi,setTileFixBleedScale:()=>Ai,setTileSizeDefault:()=>Ti,setTilesPixelated:()=>xi,setTouchGamepadAlpha:()=>Ni,setTouchGamepadAnalog:()=>ki,setTouchGamepadButtonCount:()=>ji,setTouchGamepadCenterButton:()=>Ii,setTouchGamepadEnable:()=>zi,setTouchGamepadSize:()=>Wi,setTouchInputEnable:()=>Ji,setVibrateEnable:()=>Ui,showSplashScreen:()=>Ee,showWatermark:()=>D,sign:()=>rt,sin:()=>lt,smoothStep:()=>St,soundDefaultRange:()=>oi,soundDefaultTaper:()=>si,soundEnable:()=>ei,soundVolume:()=>ii,speak:()=>Rs,speakStop:()=>Es,tan:()=>dt,textureInfos:()=>no,tile:()=>ro,tileCollisionGetData:()=>Fs,tileCollisionLayers:()=>_s,tileCollisionRaycast:()=>Js,tileCollisionTest:()=>Bs,tileFixBleedScale:()=>_e,tileLayersLoad:()=>zs,tileSizeDefault:()=>Oe,tilesPixelated:()=>De,time:()=>h,timeDelta:()=>r,timeReal:()=>d,toggleFullscreen:()=>Go,touchGamepadAlpha:()=>Ze,touchGamepadAnalog:()=>Qe,touchGamepadCenterButton:()=>Xe,touchGamepadEnable:()=>Ye,touchGamepadSize:()=>$e,uiDebug:()=>Vn,uiSetDebug:()=>Yn,uiSystem:()=>kn,vec2:()=>jt,vibrate:()=>rs,vibrateEnable:()=>ti,vibrateStop:()=>as,wave:()=>Lt,worldToScreen:()=>To,worldToScreenDelta:()=>Co,zzfx:()=>Ms,zzfxG:()=>Os});const o="LittleJS",s="1.15.8",n=60,r=1/n;let a=[],c=[],l=0,h=0,d=0,u=!1;function f(){return u}function p(t=!0){u=t}let g=0,y=0,v=0;const x=[];class b{constructor(t,e,i,o){this.update=t,this.render=e,this.glContextLost=i,this.glContextRestored=o}}function m(t,e,i,o){x.find(s=>s.update===t&&s.render===e&&s.glContextLost===i&&s.glContextRestored===o);const s=new b(t,e,i,o);x.push(s)}async function S(t,e,i,r,c,f=[],p=document.body){function b(t=0){let f=t-g;g=t,(E||D)&&(v=yt(v,1e3/(f||1),.05));const p=E&&qo("Equal"),S=E&&qo("Minus");E&&(f*=p?10:S?.1:1),d+=f/1e3,y+=u?0:f,p||(y=st(y,50));let T=!1;if(u){T=!0,m(),xs(),x.forEach(t=>t.update?.());for(const t of a)t.parent||t.updateTransforms();i(),bs()}else{let t=0;for(y<0&&y>-9&&(t=y,y=0);y>=0;y-=1e3/n)h=l++/n,T=!0,m(),xs(),e(),x.forEach(t=>t.update?.()),w(),B(),i(),bs(),K()&&A();y+=t}function A(){if(!Pe){T||m(),so=jt(he.width,he.height),fe.imageSmoothingEnabled=de.imageSmoothingEnabled=!De,Tn(),r(),a.sort((t,e)=>t.renderOrder-e.renderOrder);for(const t of a)t.destroyed||t.render();if(c(),x.forEach(t=>t.render?.()),function(){if(!Ve||!ns||Pe)return;if(!Ye||!gs.isSet())return;const t=gt(gs.get(),4,3);if(!t||u)return;const e=fe;e.save(),e.globalAlpha=t*Ze,e.strokeStyle="#fff",e.lineWidth=3;const i=vs[0]??jt();e.fillStyle=i.lengthSquared()>0?"#fff":"#000",e.beginPath();const o=jt($e,so.y-$e);if(Qe)e.arc(o.x,o.y,$e/2,0,9);else for(let t=10;--t;){const i=t*Z/4;e.arc(o.x,o.y,.6*$e,i+Z/8,i+Z/8),t%2&&e.arc(o.x,o.y,.33*$e,i,i)}e.fill(),e.stroke();{const t=ms(),i=Ke>1?$e/4:$e/2;for(let o=0;o<Ke;o++){const s=ft(o-1,4);let n=Ke>2?s:st(s,Ke-1);n=3===n?2:2===n?3:n;const r=Ke<2?t:t.add(jt().setDirection(s,$e/2));e.fillStyle=ys[n]?"#fff":"#000",e.beginPath(),e.arc(r.x,r.y,i,0,9),e.fill(),e.stroke()}}e.restore()}(),Gn(),D){fe.textAlign="right",fe.textBaseline="top",fe.font="1em monospace",fe.fillStyle="#000";const t=o+" v"+s+" / "+io+" / "+a.length+" / "+v.toFixed(1)+(Ge?" GL":" 2D");fe.fillText(t,he.width-3,3),fe.fillStyle="#fff",fe.fillText(t,he.width-2,2)}io=0}}A(),requestAnimationFrame(b)}function m(){if(!Pe){if(Ae.x){he.width=Ae.x,he.height=Ae.y;const t=innerWidth/innerHeight,e=he.width/he.height;(Ys||he).style.width=he.style.width=ue.style.width=t<e?"100%":"",(Ys||he).style.height=he.style.height=ue.style.height=t<e?"":"100%"}else he.width=st(innerWidth,Te.x),he.height=st(innerHeight,Te.y);we.a>0&&(de.fillStyle=we.toString(),de.fillRect(0,0,so.x,so.y),de.fillStyle=$t.toString()),ue.width=he.width,ue.height=he.height,so=jt(he.width,he.height),de.lineJoin=fe.lineJoin="round",de.lineCap=fe.lineCap="round"}}async function S(){await t(),b()}if(Gt(f),t||=()=>{},e||=()=>{},i||=()=>{},r||=()=>{},c||=()=>{},Pe)return S();p.style.cssText="margin:0;overflow:hidden;background:#000;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",pe=he=document.createElement("canvas"),p.appendChild(he),ge=de=he.getContext("2d"),function(){function t(t){return qe?"KeyW"===t?"ArrowUp":"KeyS"===t?"ArrowDown":"KeyA"===t?"ArrowLeft":"KeyD"===t?"ArrowRight":t:t}function e(t){const e=he.getBoundingClientRect(),i=gt(t.x,e.left,e.right),o=gt(t.y,e.top,e.bottom);return jt(i*he.width,o*he.height)}Pe||(document.addEventListener("keydown",function(e){e.repeat||(jo=!1,ds[0][e.code]=3,qe&&(ds[0][t(e.code)]=3)),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","Tab","Backspace"].includes(e.code)&&ko&&document.hasFocus()&&e.cancelable&&e.preventDefault()}),document.addEventListener("keyup",function(e){ds[0][e.code]=2&ds[0][e.code]|4,qe&&(ds[0][t(e.code)]=4)}),document.addEventListener("mousedown",function(t){if(ns&&Ve)return;ei&&!Pe&&ws&&!As()&&ws.resume(),jo=!1,ds[0][t.button]=3;const i=Fo;Fo=e(jt(t.x,t.y)),Jo=Jo.add(Fo.subtract(i)),ko&&document.hasFocus()&&t.cancelable&&t.preventDefault()}),document.addEventListener("mouseup",function(t){ns&&Ve||(ds[0][t.button]=2&ds[0][t.button]|4)}),document.addEventListener("mousemove",function(t){Io=!0;const i=Fo;Fo=e(jt(t.x,t.y));const o=hs()?jt(t.movementX,t.movementY):Fo.subtract(i);Jo=Jo.add(o)}),document.addEventListener("mouseleave",function(){Io=!1}),document.addEventListener("wheel",function(t){zo=t.ctrlKey?0:rt(t.deltaY)}),document.addEventListener("contextmenu",function(t){t.preventDefault()}),document.addEventListener("blur",function(){Ho()}),ns&&Ve&&function(){let t;function i(i){if(!Ve)return;Ye&&function(i){if(vs.length=0,vs[0]=jt(),vs[1]=jt(),ys.length=0,jo=!0,i.touches.length&&(gs.set(),Xe&&!t&&u))return void(ys[9]=1);if(u)return;const o=jt($e,so.y-$e),s=ms(),n=so.scale(.5);for(const t of i.touches){const i=e(jt(t.clientX,t.clientY));if(o.distance(i)<$e){const t=i.subtract(o);vs[0]=t.scale(2/$e).clampLength()}else if(s.distance(i)<$e){if(1===Ke){const t=i.subtract(s);vs[1]=t.scale(2/$e).clampLength()}let t=s.subtract(i).direction();if(t=ft(t+2,4),1===Ke)t=0;else if(2===Ke){const e=s.subtract(i);t=-e.x<e.y?1:0}t=3===t?2:2===t?3:t,t<Ke&&(ys[t]=1)}else Xe&&n.distance(i)<$e&&(ys[9]=1)}}(i),ei&&!Pe&&ws&&!As()&&ws.resume();const o=i.touches.length;if(o){const o=jt(i.touches[0].clientX,i.touches[0].clientY),s=Fo;Fo=e(o),t?(Jo=Jo.add(Fo.subtract(s)),jo=Ye):ds[0][0]=3}else t&&(ds[0][0]=2&ds[0][0]|4);return t=o,ko&&document.hasFocus()&&i.cancelable&&i.preventDefault(),!0}document.addEventListener("touchstart",t=>i(t),{passive:!1}),document.addEventListener("touchmove",t=>i(t),{passive:!1}),document.addEventListener("touchend",t=>i(t),{passive:!1})}())}(),ei&&!Pe&&(Ss=ws.createGain(),Ss.connect(ws.destination),Ss.gain.value=ii),function(){if(dn=new Set,!Ge||Pe)return void(fn=!1);if(Ys=document.createElement("canvas"),Xs=Ys.getContext("webgl2",{antialias:un}),!Xs)return console.warn("WebGL2 not supported, falling back to 2D canvas rendering!"),Ys=Xs=void 0,Ge=!1,void(fn=!1);function t(){Zs=Dn("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}","#version 300 es\nprecision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}"),tn=Dn("#version 300 es\nprecision highp float;uniform mat4 m;in vec2 p;in vec4 c;out vec4 d;void main(){gl_Position=m*vec4(p,1,1);d=c;}","#version 300 es\nprecision highp float;in vec4 d;out vec4 c;void main(){c=d;}");const t=new ArrayBuffer(pn);cn=new Float32Array(t),ln=new Uint32Array(t),rn=Xs.createBuffer(),an=Xs.createBuffer();const e=new Float32Array([hn=0,0,1,0,0,1,1,1]);Xs.bindBuffer(Xs.ARRAY_BUFFER,an),Xs.bufferData(Xs.ARRAY_BUFFER,e,Xs.STATIC_DRAW)}he.parentElement.appendChild(Ys),t(),Ys.addEventListener("webglcontextlost",t=>{Ge=!1,Ys.style.display="none",t.preventDefault();for(const t of dn)t.glTexture=void 0;nn=void 0,x.forEach(t=>t.glContextLost?.())}),Ys.addEventListener("webglcontextrestored",()=>{Ge=!0,Ys.style.display="",t();for(const t of dn)t.glTexture=Rn(t.image);x.forEach(t=>t.glContextRestored?.())})}(),ue=document.createElement("canvas"),p.appendChild(ue),fe=ue.getContext("2d");const T="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";he.style.cssText=ue.style.cssText=T,Ys&&(Ys.style.cssText=T),yi(Ce),vi(Le),m(),Tn(),ye=new OffscreenCanvas(256,256),ve=ye.getContext("2d",{willReadFrequently:!0});const A=f.map((t,e)=>new Promise(i=>{Pt(t);const o=new Image;o.onerror=o.onload=()=>{const t=new co(o);no[e]=t,i()},o.crossOrigin="anonymous",o.src=t}));return f.length||A.push(new Promise(t=>{const e=new co(new Image);no[0]=e,t()})),Ee&&A.push(new Promise(t=>{let e=0;console.log(`${o} Engine v${s}`),function i(){Ho(),function(t){const e=fe,i=ue.width=innerWidth,s=ue.height=innerHeight;{const o=gt(t,1,.8),n=gt(t,0,.5),r=e.createRadialGradient(i/2,s/2,0,i/2,s/2,.7*at(i,s));r.addColorStop(0,qt(0,0,yt(0,o/2,n),o).toString()),r.addColorStop(1,qt(0,0,0,o).toString()),e.save(),e.fillStyle=r,e.fillRect(0,0,i,s)}const n=(t,i,o,s,n)=>{e.beginPath(),e.rect(t,i,o,n?s*h:s),e.fillStyle=n,n?e.fill():e.stroke()},r=(t,i,o,s)=>{e.beginPath(),e.lineTo(t,i),e.lineTo(o,s),e.stroke()},a=(t,i,o,s=0,n=2*Z,r,a)=>{const c=(s+n)/2,l=h*(n-s)/2;e.beginPath(),a&&e.lineTo(t,i),e.arc(t,i,o,c-l,c+l),e.fillStyle=r,r?e.fill():e.stroke()},c=(t=0,e=0)=>qt([.98,.3,.57,.14][t%4],.8,[0,.3,.5,.8,.9][e]).toString(),l=Lt(1,1,t),h=gt(l,.1,.5);e.translate(i/2,s/2);const d=st(6,st(i,s)/99);e.scale(d,d),e.translate(-40,-35),e.lineJoin=e.lineCap="round",e.lineWidth=.1+1.9*h;const u=gt(l,.1,1);e.setLineDash([99*u,99]),n(7,16,18,-8,c(2,2)),n(7,8,18,4,c(2,3)),n(25,8,8,8,c(2,1)),n(25,8,-18,8),n(25,8,8,8),n(25,16,7,23,c()),n(11,39,14,-23,c(1,1)),n(11,16,14,18,c(1,2)),n(11,16,14,8,c(1,3)),n(25,16,-14,24),n(15,29,6,-9,c(2,2)),a(15,21,5,0,Z/2,c(2,4),1),n(21,21,-6,9),n(37,14,9,6,c(3,2)),n(37,14,4.5,6,c(3,3)),n(37,14,9,6),n(50,20,10,-8,c(0,1)),n(50,20,6.5,-8,c(0,2)),n(50,20,3.5,-8,c(0,3)),n(50,20,10,-8),a(55,2,11.4,.5,Z-.5,c(3,3)),a(55,2,11.4,.5,Z/2,c(3,2),1),a(55,2,11.4,.5,Z-.5),n(45,7,20,-7,c(0,2)),n(45,-1,20,4,c(0,3)),n(45,-1,20,8);for(let t=5;t--;)a(60-6*t,30,9.9,0,2*Z,c(t+2,3)),a(60-6*t,30,10,-.5,Z+.5,c(t+2,2)),a(60-6*t,30,10.1,.5,Z-.5,c(t+2,1));a(36,30,10,Z/2,3*Z/2),a(48,30,10,Z/2,3*Z/2),a(60,30,10),r(36,20,60,20),a(60,30,4,Z,3*Z,c(3,2)),a(60,30,4,Z,2*Z,c(3,3)),a(60,30,4,Z,3*Z);for(let t=6;t--;)e.beginPath(),e.lineTo(53,54),e.lineTo(53,40),e.lineTo(53+(1+2.9*t)*h,40),e.lineTo(53+(4+3.5*t)*h,54),e.fillStyle=c(0,t%2+2),e.fill(),t%2&&e.stroke();n(6,40,5,5),n(6,40,5,5,c()),n(15,54,38,-14,c());for(let t=3;t--;)for(let i=2;i--;)a(15*t+15,47,i?7:1,Z,3*Z,c(t,3)),e.stroke(),a(15*t+15,47,i?7:1,0,Z,c(t,2)),e.stroke();r(6,40,68,40),r(77,54,4,54);const f=o;e.font="900 16px arial",e.textAlign="center",e.textBaseline="top",e.lineWidth=.1+3.9*h;let p=0;for(let t=0;t<f.length;++t)p+=e.measureText(f[t]).width;for(let t=2;t--;)for(let i=0,o=41-p/2;i<f.length;++i){e.fillStyle=c(i,2);const s=e.measureText(f[i]).width;e[t?"strokeText":"fillText"](f[i],o+s/2,55.5,17*h),o+=s}e.restore()}(e+=.01),e>1?t():setTimeout(i,16)}()})),await Promise.all(A),S()}function w(){function t(e){if(!e.destroyed){e.update();for(const i of e.children)t(i)}}c=a.filter(t=>t.collideSolidObjects);for(const e of a)if(!e.parent){e.update(),e.updatePhysics();for(const i of e.children)t(i);e.updateTransforms()}a=a.filter(t=>!t.destroyed)}function T(){for(const t of a)t.parent||t.destroy();a=a.filter(t=>!t.destroyed)}function A(t,e,i=a){const o=[];if(t)if(e instanceof Ut)for(const s of i)s.isOverlapping(t,e)&&o.push(s);else{const s=e*e;for(const e of i)t.distanceSquared(e.pos)<s&&o.push(e)}else for(const t of i)o.push(t);return o}function C(t,e,i,o=a){A(t,e,o).forEach(t=>i(t))}function L(t,e,i=a){const o=[];for(const s of i)s.collideRaycast&&Ct(t,e,s.pos,s.size)&&(M&&J(s.pos,s.size),o.push(s));return M&&o.length,o}let D=0,R="";const E=0,P=0,G=0,M=0,O=0;function _(){}function F(){}function B(){}function J(){}function z(){}function I(){}function j(){}function k(){}function W(){}function N(){}function U(){}function H(){}function q(){}function V(){}function Y(){}function X(){}function K(){return!1}function Q(){}function $(){}const Z=Math.PI,tt=Math.abs,et=Math.floor,it=Math.ceil,ot=Math.round,st=Math.min,nt=Math.max,rt=Math.sign,at=Math.hypot,ct=Math.log2,lt=Math.sin,ht=Math.cos,dt=Math.tan,ut=Math.atan2;function ft(t,e=1){return(t%e+e)%e}function pt(t,e=0,i=1){return t<e?e:t>i?i:t}function gt(t,e,i){return(i-=e)?pt((t-e)/i):0}function yt(t,e,i){return t>=0&&t<=1&&(e<0||e>1)&&(i<0||i>1)&&console.warn("lerp() parameter order changed! use lerp(start, end, p)"),t+pt(i)*(e-t)}function vt(t,e,i=1){const o=(t-e)%i;return 2*o%i-o}function xt(t,e,i,o=1){return t>=0&&t<=1&&(e<0||e>1)&&(i<0||i>1)&&console.warn("lerpWrap() parameter order changed! use lerpWrap(start, end, p)"),t+pt(i)*vt(e,t,o)}function bt(t,e){return vt(t,e,2*Z)}function mt(t,e,i){return xt(t,e,i,2*Z)}function St(t){return t*t*(3-2*t)}function wt(t){return!(t&t-1)}function Tt(t){return 2**it(ct(t))}function At(t,e,i,o=jt()){const s=2*(t.x-i.x),n=2*(t.y-i.y),r=e.x+o.x,a=e.y+o.y;return s>=-r&&s<r&&n>=-a&&n<a}function Ct(t,e,i,o){const s=i.subtract(o.scale(.5)),n=s.add(o),r=e.subtract(t),a=t.subtract(s),c=t.subtract(n),l=[-r.x,r.x,-r.y,r.y],h=[a.x,-c.x,a.y,-c.y];let d=0,u=1;for(let t=4;t--;)if(l[t]){const e=h[t]/l[t];if(l[t]<0){if(e>u)return!1;d=nt(e,d)}else{if(e<d)return!1;u=st(e,u)}}else if(h[t]<0)return!1;return!0}function Lt(t=1,e=1,i=h,o=0){return e/2*(1-ht(o+i*t*2*Z))}function Dt(t){return(t<0?"-":"")+((t=0|tt(t))/60|0)+":"+(t%60<10?"0":"")+t%60}async function Rt(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch JSON from ${t}: ${e.status} ${e.statusText}`);return e.json()}function Et(t){return"number"==typeof t&&!isNaN(t)}function Pt(t){return null!=t&&"string"==typeof t.toString()}function Gt(t){return Array.isArray(t)}function Mt(t=1,e=0){return e+Math.random()*(t-e)}function Ot(t,e=0){return et(Mt(t,e))}function _t(t=.5){return Mt()<t}function Ft(){return 2*Ot(2)-1}function Bt(t=1){return(new Ut).setAngle(Mt(2*Z),t)}function Jt(t=1,e=0){return t>0?Bt(t*Mt(e/t,1)**.5):new Ut}function zt(t=new Xt,e=new Xt(0,0,0,1),i=!1){return i?t.lerp(e,Mt()):new Xt(Mt(t.r,e.r),Mt(t.g,e.g),Mt(t.b,e.b),Mt(t.a,e.a))}class It{constructor(t=123456789){this.seed=t}float(t=1,e=0){return this.seed^=this.seed<<13,this.seed^=this.seed>>>17,this.seed^=this.seed<<5,e+(t-e)*((this.seed>>>0)/2**32)}int(t,e=0){return et(this.float(t,e))}bool(t=.5){return this.float()<t}sign(){return this.float()>.5?1:-1}floatSign(t=1,e=0){return this.float(t,e)*this.sign()}angle(){return this.float(-Z,Z)}vec2(t=1,e=0){return jt(this.float(t,e),this.float(t,e))}randColor(t=new Xt,e=new Xt(0,0,0,1),i=!1){return i?t.lerp(e,this.float()):new Xt(this.float(t.r,e.r),this.float(t.g,e.g),this.float(t.b,e.b),this.float(t.a,e.a))}mutateColor(t,e=.05,i=0){return Nt(e),Nt(i),new Xt(t.r+this.float(e,-e),t.g+this.float(e,-e),t.b+this.float(e,-e),t.a+this.float(i,-i)).clamp()}}function jt(t=0,e){return new Ut(t,void 0===e?t:e)}function kt(t){return t instanceof Ut&&t.isValid()}function Wt(t){kt(t)}function Nt(t){Et(t)}class Ut{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,Wt(this),this}setFrom(t){return this.set(t.x,t.y)}copy(){return new Ut(this.x,this.y)}add(t){return new Ut(this.x+t.x,this.y+t.y)}subtract(t){return new Ut(this.x-t.x,this.y-t.y)}multiply(t){return new Ut(this.x*t.x,this.y*t.y)}divide(t){return new Ut(this.x/t.x,this.y/t.y)}scale(t){return new Ut(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new Ut(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this.copy()}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}reflect(t,e=1){return this.subtract(t.scale((1+e)*this.dot(t)))}angle(){return ut(this.x,this.y)}setAngle(t=0,e=1){return Nt(t),Nt(e),this.x=e*lt(t),this.y=e*ht(t),this}rotate(t){Nt(t);const e=ht(-t),i=lt(-t);return new Ut(this.x*e-this.y*i,this.x*i+this.y*e)}setDirection(t,e=1){return Nt(t),Nt(e),t=ft(t,4),this.x=t%2?t-1?-e:e:0,this.y=t%2?0:t?-e:e,this}direction(){return tt(this.x)>tt(this.y)?this.x<0?3:1:this.y<0?2:0}abs(){return new Ut(tt(this.x),tt(this.y))}floor(){return new Ut(et(this.x),et(this.y))}mod(t=1){return new Ut(ft(this.x,t),ft(this.y,t))}area(){return tt(this.x*this.y)}isZero(){return!this.x&&!this.y}lerp(t,e){Wt(t),Nt(e);const i=pt(e);return new Ut(t.x*i+this.x*(1-i),t.y*i+this.y*(1-i))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return Nt(t),this.isValid()?`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`:`(${this.x}, ${this.y})`}isValid(){return Et(this.x)&&Et(this.y)}}function Ht(t,e,i,o){return new Xt(t,e,i,o)}function qt(t,e,i,o){return(new Xt).setHSLA(t,e,i,o)}function Vt(t){return t instanceof Xt&&t.isValid()}function Yt(t){Vt(t)}class Xt{constructor(t=1,e=1,i=1,o=1){this.r=t,this.g=e,this.b=i,this.a=o,this.isValid()}set(t=1,e=1,i=1,o=1){return this.r=t,this.g=e,this.b=i,this.a=o,Yt(this),this}setFrom(t){return this.set(t.r,t.g,t.b,t.a)}copy(){return new Xt(this.r,this.g,this.b,this.a)}add(t){return new Xt(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new Xt(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new Xt(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new Xt(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new Xt(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new Xt(pt(this.r),pt(this.g),pt(this.b),pt(this.a))}lerp(t,e){Yt(t),Nt(e);const i=pt(e);return new Xt(t.r*i+this.r*(1-i),t.g*i+this.g*(1-i),t.b*i+this.b*(1-i),t.a*i+this.a*(1-i))}setHSLA(t=0,e=0,i=1,o=1){t=ft(t,1),e=pt(e);const s=(i=pt(i))<.5?i*(1+e):i+e-i*e,n=2*i-s,r=(t,e,i)=>6*(i=ft(i,1))<1?t+6*(e-t)*i:2*i<1?e:3*i<2?t+(e-t)*(4-6*i):t;return this.r=r(n,s,t+1/3),this.g=r(n,s,t),this.b=r(n,s,t-1/3),this.a=o,Yt(this),this}HSLA(){const t=pt(this.r),e=pt(this.g),i=pt(this.b),o=pt(this.a),s=nt(t,e,i),n=st(t,e,i),r=(s+n)/2;let a=0,c=0;if(s!==n){let o=s-n;c=r>.5?o/(2-s-n):o/(s+n),t===s?a=(e-i)/o+(e<i?6:0):e===s?a=(i-t)/o+2:i===s&&(a=(t-e)/o+4)}return[a/6,c,r,o]}mutate(t=.05,e=0){return Nt(t),Nt(e),new Xt(this.r+Mt(t,-t),this.g+Mt(t,-t),this.b+Mt(t,-t),this.a+Mt(e,-e)).clamp()}toString(t=!0){if(E&&!this.isValid())return"#000";const e=t=>((t=255*pt(t)|0)<16?"0":"")+t.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){if(Pt(t),t[0],[4,5,7,9].includes(t.length),t.length<6){const e=e=>pt(parseInt(t[e],16)/15);this.r=e(1),this.g=e(2),this.b=e(3),this.a=5===t.length?e(4):1}else{const e=e=>pt(parseInt(t.slice(e,e+2),16)/255);this.r=e(1),this.g=e(3),this.b=e(5),this.a=9===t.length?e(7):1}return Yt(this),this}rgbaInt(){return(255*pt(this.r)|0)+(255*pt(this.g)<<8)+(255*pt(this.b)<<16)+(255*pt(this.a)<<24)}isValid(){return Et(this.r)&&Et(this.g)&&Et(this.b)&&Et(this.a)}}const Kt=Ht(),Qt=Ht(1,1,1,0),$t=Ht(0,0,0),Zt=Ht(0,0,0,0),te=Ht(.5,.5,.5),ee=Ht(1,0,0),ie=Ht(1,.5,0),oe=Ht(1,1,0),se=Ht(0,1,0),ne=Ht(0,1,1),re=Ht(0,0,1),ae=Ht(.5,0,1),ce=Ht(1,0,1);class le{constructor(t,e=!1){void 0===t||Et(t),this.useRealTime=e;const i=this.getGlobalTime();this.time=void 0===t?void 0:i+t,this.setTime=t}set(t=0){Et(t);const e=this.getGlobalTime();this.time=e+t,this.setTime=t}setUseRealTime(t=!0){this.isSet(),this.useRealTime=t}unset(){this.time=void 0}isSet(){return void 0!==this.time}active(){return this.getGlobalTime()<this.time}elapsed(){return this.getGlobalTime()>=this.time}get(){return this.isSet()?this.getGlobalTime()-this.time:0}getPercent(){return this.isSet()?1-gt(this.time-this.getGlobalTime(),0,this.setTime):0}getSetTime(){return this.isSet()?this.setTime:0}getGlobalTime(){return this.useRealTime?d:h}toString(){return this.isSet()?tt(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let he,de,ue,fe,pe,ge,ye,ve,xe=jt(),be=0,me=32,Se=!0,we=Zt,Te=jt(1920,1080),Ae=jt(),Ce=!0,Le=!1,De=!0,Re="arial",Ee=!1,Pe=!1,Ge=!0,Me=32,Oe=jt(16),_e=0,Fe=!0,Be=1,Je=1,ze=1,Ie=0,je=.8,ke=1,We=jt(),Ne=1,Ue=!0,He=!0,qe=!0,Ve=!0,Ye=!1,Xe=!0,Ke=4,Qe=!0,$e=99,Ze=.3,ti=!0,ei=!0,ii=.3,oi=40,si=.7,ni=5,ri=.5,ai=jt(640,80),ci=!1;function li(t){xe=t.copy()}function hi(t){be=t}function di(t){me=t}function ui(t){Se=t}function fi(t){we=t.copy()}function pi(t){Te=t.copy()}function gi(t){Ae=t.copy()}function yi(t){Ce=t,he&&(he.style.imageRendering=t?"pixelated":""),Ys&&(Ys.style.imageRendering=t?"pixelated":"")}function vi(t){Le=t,ue&&(ue.style.imageRendering=t?"pixelated":"")}function xi(t){De=t}function bi(t){Re=t}function mi(t){Ee=t}function Si(t){Pe=t}function wi(t){!t||fn?(Ge=t,Ys&&(Ys.style.display=t?"":"none")):console.warn("Can not enable WebGL if it was disabled on start.")}function Ti(t){Oe=t.copy()}function Ai(t){_e=t}function Ci(t){Fe=t}function Li(t){Be=t}function Di(t){Je=t}function Ri(t){ze=t}function Ei(t){Ie=t}function Pi(t){je=t}function Gi(t){ke=t}function Mi(t){We=t.copy()}function Oi(t){Ne=t}function _i(t){Ue=t}function Fi(t){He=t}function Bi(t){qe=t}function Ji(t){Ve=t}function zi(t){Ye=t}function Ii(t){Xe=t}function ji(t){Ke=t}function ki(t){Qe=t}function Wi(t){$e=t}function Ni(t){Ze=t}function Ui(t){ti=t}function Hi(t){ei=t}function qi(t){ii=t,ei&&!Pe&&Ss&&(Ss.gain.value=t)}function Vi(t){oi=t}function Yi(t){si=t}function Xi(t){ni=t}function Ki(t){ri=t}function Qi(t){ai=t.copy()}function $i(t){ci=t}function Zi(t){D=t}function to(t){R=t}class eo{constructor(t=jt(),e=jt(1),i,o=0,s=Kt,n=0){kt(t),kt(e),"number"==typeof o&&isFinite(o),Vt(s),this.pos=t.copy(),this.size=e.copy(),this.drawSize=void 0,this.tileInfo=i,this.angle=o,this.color=s.copy(),this.additiveColor=void 0,this.mirror=!1,this.mass=Be,this.damping=Je,this.angleDamping=ze,this.restitution=Ie,this.friction=je,this.gravityScale=1,this.renderOrder=n,this.velocity=jt(),this.angleVelocity=0,this.spawnTime=h,this.children=[],this.clampSpeed=!0,this.groundObject=void 0,this.parent=void 0,this.localPos=jt(),this.localAngle=0,this.collideTiles=!1,this.collideSolidObjects=!1,this.isSolid=!1,this.collideRaycast=!1,a.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(jt(e,1)).rotate(t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const t of this.children)t.updateTransforms()}updatePhysics(){this.parent,this.clampSpeed&&(this.velocity.x=pt(this.velocity.x,-ke,ke),this.velocity.y=pt(this.velocity.y,-ke,ke));const t=this.pos.copy();if(this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.x+=We.x*this.gravityScale,this.velocity.y+=We.y*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,this.angleDamping>=0&&this.angleDamping,this.damping>=0&&this.damping,!Fe||!this.mass)return;const e=this.velocity.y<0&&We.y<0||this.velocity.y>0&&We.y>0;if(this.groundObject){const t=nt(this.friction,this.groundObject.friction),e=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=e+(this.velocity.x-e)*t,this.groundObject=void 0}if(this.collideSolidObjects){const i=.001;for(const o of c){if(!this.isSolid&&!o.isSolid||o.destroyed||o.parent||o===this)continue;if(!this.isOverlappingObject(o))continue;const s=this.collideWithObject(o),n=o.collideWithObject(this);if(!s||!n)continue;if(At(t,this.size,o.pos,o.size)){const e=t.subtract(o.pos),i=e.length(),s=.001,n=i<.01?Bt(s):e.scale(s/i);this.velocity=this.velocity.add(n),o.mass&&(o.velocity=o.velocity.subtract(n)),G&&W(this.pos,this.size,o.pos,o.size);continue}const r=this.size.add(o.size),a=2*(t.y-o.pos.y)>r.y+We.y,c=2*tt(t.y-o.pos.y)<r.y,l=2*tt(t.x-o.pos.x)<r.x,h=nt(this.restitution,o.restitution);if(a||l||!c)if(this.pos.y=o.pos.y+(r.y/2+i)*rt(t.y-o.pos.y),o.groundObject&&e||!o.mass)e&&(this.groundObject=o),this.velocity.y*=-h;else if(o.mass){const t=(this.mass*this.velocity.y+o.mass*o.velocity.y)/(this.mass+o.mass),e=this.velocity.y*(this.mass-o.mass)/(this.mass+o.mass)+2*o.velocity.y*o.mass/(this.mass+o.mass),i=o.velocity.y*(o.mass-this.mass)/(this.mass+o.mass)+2*this.velocity.y*this.mass/(this.mass+o.mass);this.velocity.y=yt(t,e,h),o.velocity.y=yt(t,i,h)}if(!a&&c)if(this.pos.x=o.pos.x+(r.x/2+i)*rt(t.x-o.pos.x),o.mass){const t=(this.mass*this.velocity.x+o.mass*o.velocity.x)/(this.mass+o.mass),e=this.velocity.x*(this.mass-o.mass)/(this.mass+o.mass)+2*o.velocity.x*o.mass/(this.mass+o.mass),i=o.velocity.x*(o.mass-this.mass)/(this.mass+o.mass)+2*this.velocity.x*this.mass/(this.mass+o.mass);this.velocity.x=yt(t,e,h),o.velocity.x=yt(t,i,h)}else this.velocity.x*=-h;G&&W(this.pos,this.size,o.pos,o.size)}}if(this.collideTiles){const i=Bs(this.pos,this.size,this);if(i&&!Bs(t,this.size,this)){const o=Bs(jt(t.x,this.pos.y),this.size,this),s=Bs(jt(this.pos.x,t.y),this.size,this);if(s){const e=.001,i=.1,o=et(t.y-this.size.y/2+1)+this.size.y/2+e;if(o-this.pos.y<i&&!Bs(jt(this.pos.x,o),this.size,this))return this.pos.y=o,void(G&&(this.pos,this.size));this.pos.x=t.x,this.velocity.x*=-this.restitution}if(o||!s){const o=nt(this.restitution,i.restitution);if(this.velocity.y*=-o,e){const e=1e-4,o=this.size.y/2+e;this.pos.y=We.y<0?et(t.y-this.size.y/2)+o:it(t.y+this.size.y/2)-o,this.groundObject=i}else this.pos.y=t.y,this.groundObject=void 0}G&&(this.pos,this.size)}}}update(){}render(){lo(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.parent=0,t.destroy()}}localToWorld(t){return this.pos.add(t.rotate(this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(-this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return t>0}collideWithObject(t){return!0}getUp(t=1){return jt().setAngle(this.angle,t)}getRight(t=1){return jt().setAngle(this.angle+Z/2,t)}getAliveTime(){return h-this.spawnTime}getSpeed(){return this.velocity.length()}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyAngularAcceleration(t){this.mass&&(this.angleVelocity+=t)}applyForce(t){this.mass&&this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=jt(),i=0){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=i}removeChild(t){t.parent===this&&this.children.includes(t);const e=this.children.indexOf(t);e>=0&&this.children.splice(e,1),t.parent=0}isOverlappingObject(t){return this.isOverlapping(t.pos,t.size)}isOverlapping(t,e=jt()){return At(this.pos,this.size,t,e)}setCollision(t=!0,e=!0,i=!0,o=!0){this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=i,this.collideRaycast=o}toString(){if(!E)return;let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+="\npos = "+this.pos),(this.velocity.x||this.velocity.y)&&(t+="\nvelocity = "+this.velocity),(this.size.x||this.size.y)&&(t+="\nsize = "+this.size),this.angle&&(t+="\nangle = "+this.angle.toFixed(3)),this.color&&(t+="\ncolor = "+this.color),t}renderDebugInfo(){if(!E)return;const t=jt(nt(this.size.x,.2),nt(this.size.y,.2)),e=Ht(this.collideTiles?1:0,this.collideSolidObjects?1:0,this.isSolid?1:0,.5);ho(this.pos,t,e,this.angle),this.parent&&ho(this.pos,t.scale(.8),Ht(1,1,1,.5),this.angle),this.parent&&po(this.pos,this.parent.pos,.1,Ht(1,1,1,.5))}}let io,oo,so=jt(),no=[];function ro(t=new Ut,e=Oe,i=0,o=0){if(Pe)return new ao;"number"==typeof e&&(e=new Ut(e,e));const s=new ao(new Ut,e,i,o),n=no[i],r=e.x+2*o,a=e.y+2*o;if("number"==typeof t){const e=n.size.x/r|0,i=t%e,c=t/e|0;s.pos.set(i*r+o,c*a+o)}else s.pos.set(t.x*r+o,t.y*a+o);return s}class ao{constructor(t=jt(),e=Oe,i=0,o=0,s=_e){this.pos=t.copy(),this.size=e.copy(),this.textureIndex=i,this.padding=o,this.textureInfo=no[this.textureIndex],this.bleedScale=s}offset(t){return new ao(this.pos.add(t),this.size,this.textureIndex,this.padding,this.bleedScale)}frame(t){return this.offset(new Ut(t*(this.size.x+2*this.padding),0))}setFullImage(t){return this.pos=new Ut,this.size=t.size.copy(),this.textureInfo=t,this.bleedScale=this.padding=0,this}}class co{constructor(t,e=!0){this.image=t,this.size=t?jt(t.width,t.height):jt(),this.sizeInverse=t?jt(1/t.width,1/t.height):jt(),this.glTexture=void 0,e&&this.createWebGLTexture()}createWebGLTexture(){var t;t=this,Pe||(dn.add(t),Xs&&(t.glTexture?Pn(t.glTexture,t.image):t.glTexture=Rn(t.image)))}destroyWebGLTexture(){!function(t){if(Pe)return;dn.delete(t);const e=t.glTexture;t.glTexture=void 0,En(e)}(this)}hasWebGL(){return!!this.glTexture}}function lo(t,e=new Ut(1),i,o=Kt,s=0,n,r,a=Ge,c,l){kt(t),kt(e),Vt(o),Et(s),!r||Vt(r);const h=i&&i.textureInfo,d=i?i.bleedScale:0;if(a&&Ge)if(c&&([t,e,s]=Lo(t,e,s)),h){const a=h.sizeInverse,c=i.pos.x*a.x,l=i.pos.y*a.y,u=i.size.x*a.x,f=i.size.y*a.y;if(Cn(h.glTexture),d){const i=a.x*d,h=a.y*d;_n(t.x,t.y,n?-e.x:e.x,e.y,s,c+i,l+h,c-i+u,l-h+f,o.rgbaInt(),r&&r.rgbaInt())}else _n(t.x,t.y,n?-e.x:e.x,e.y,s,c,l,c+u,l+f,o.rgbaInt(),r&&r.rgbaInt())}else _n(t.x,t.y,e.x,e.y,s,0,0,0,0,0,o.rgbaInt());else++io,xo(t,e=new Ut(e.x,-e.y),s,n,t=>{if(h){const e=i.pos.x,s=i.pos.y,n=i.size.x,a=i.size.y;!function(t,e,i,o,s,n,r,a,c,l,h,d,u=0){function f(t){return t.r>=1&&t.g>=1&&t.b>=1}const p=u,g=u,y=(s=nt(1,0|s))-2*u,v=(n=nt(1,0|n))-2*u;if(!Se||(d?f(h.add(d))&&d.a<=0:f(h)))t.globalAlpha=h.a,t.drawImage(e,i+p,o+g,y,v,r,a,c,l),t.globalAlpha=1;else{ye.width=s,ye.height=n,ve.drawImage(e,0|i,0|o,s,n,0,0,s,n);const u=ve.getImageData(0,0,s,n),f=u.data;if(!d||(x=d).r<=0&&x.g<=0&&x.b<=0&&x.a<=0){for(let t=0;t<f.length;t+=4)f[t]*=h.r,f[t+1]*=h.g,f[t+2]*=h.b;ve.putImageData(u,0,0),t.globalAlpha=h.a,t.drawImage(ye,p,g,y,v,r,a,c,l),t.globalAlpha=1}else{const e=[h.r,h.g,h.b,h.a],i=[255*d.r,255*d.g,255*d.b,255*d.a];for(let t=0;t<f.length;++t)f[t]=f[t]*e[3&t]+i[3&t]|0;ve.putImageData(u,0,0),t.drawImage(ye,p,g,y,v,r,a,c,l)}}var x}(t,h.image,e,s,n,a,-.5,-.5,1,1,o,r,d)}else{const e=r?o.add(r):o;t.fillStyle=e.toString(),t.fillRect(-.5,-.5,1,1)}},c,l)}function ho(t,e,i,o,s,n,r){lo(t,e,void 0,i,o,!1,void 0,s,n,r)}function uo(t,e,i=Kt,o=$t,s=0,n=Ge,r=!1,a){if(kt(t),kt(e),Vt(i)&&Vt(o),Et(s),n&&Ge){r&&(t=wo(t),e=e.scale(1/me),s+=be);const n=[],a=[],c=e.x/2,l=e.y/2,h=i.rgbaInt(),d=o.rgbaInt(),u=ht(-s),f=lt(-s);for(let e=4;e--;){const i=1&e?c:-c,o=2&e?l:-l,s=i*u-o*f,r=i*f+o*u,p=2&e?h:d;n.push(jt(t.x+s,t.y+r)),a.push(p)}zn(n,a)}else++io,xo(t,e=new Ut(e.x,-e.y),s,!1,t=>{const e=t.createLinearGradient(0,-.5,0,.5);e.addColorStop(0,i.toString()),e.addColorStop(1,o.toString()),t.fillStyle=e,t.fillRect(-.5,-.5,1,1)},r,a)}function fo(t,e=.1,i,o=!1,s=jt(),n=0,r=Ge,a,c){if(Gt(t),Et(e),Vt(i),kt(s),Et(n),r&&Ge){let r=jt(1);a&&([s,r,n]=Lo(s,r,n)),Bn(t,i.rgbaInt(),e,s.x,s.y,r.x,r.y,n,o)}else++io,xo(s,jt(1),n,!1,s=>{s.strokeStyle=i.toString(),s.lineWidth=e,s.beginPath();for(let e=0;e<t.length;++e){const i=t[e];e?s.lineTo(i.x,i.y):s.moveTo(i.x,i.y)}o&&s.closePath(),s.stroke()},a,c)}function po(t,e,i=.1,o,s=jt(),n=0,r,a,c){const l=jt((e.x-t.x)/2,(e.y-t.y)/2),h=jt(i,2*l.length());s=s.add(t.add(l)),a&&(l.y*=-1),ho(s,h,o,n+=l.angle(),r,a,c)}function go(t,e=Kt,i=0,o=$t,s=jt(),n=0,r=Ge,a=!1,c=void 0){if(kt(s),Gt(t),Vt(e)&&Vt(o),Et(i),Et(n),r&&Ge){let r=jt(1);a&&([s,r,n]=Lo(s,r,n)),Fn(t,e.rgbaInt(),s.x,s.y,r.x,r.y,n),i>0&&Bn(t,o.rgbaInt(),i,s.x,s.y,r.x,r.y,n)}else xo(s,jt(1),n,!1,s=>{s.fillStyle=e.toString(),s.beginPath();for(const e of t)s.lineTo(e.x,e.y);s.closePath(),s.fill(),i&&(s.strokeStyle=o.toString(),s.lineWidth=i,s.stroke())},a,c)}function yo(t,e=jt(1),i=Kt,o=0,s=0,n=$t,r=Ge,a=!1,c){kt(t),kt(e),Vt(i)&&Vt(n),Et(o),Et(s),s>=0&&s<e.x&&e.y,r&&Ge?function(t,e=jt(1),i=3,o=Kt,s=0,n=$t,r=0,a=Ge,c=!1,l){kt(e),Et(i);const h=[],d=e.x/2,u=e.y/2;for(let t=i;t--;){const e=t/i*Z*2;h.push(jt(lt(e)*d,ht(e)*u))}go(h,o,s,n,t,r,a,c,l)}(t,e,Me,i,s,n,o,r,a,c):xo(t,jt(1),o,!1,t=>{t.fillStyle=i.toString(),t.beginPath(),t.ellipse(0,0,e.x/2,e.y/2,0,0,9),t.fill(),s&&(t.strokeStyle=n.toString(),t.lineWidth=s,t.stroke())},a,c)}function vo(t,e=1,i=Kt,o=0,s=$t,n=Ge,r=!1,a){Et(e),yo(t,jt(e),i,0,o,s,n,r,a)}function xo(t,e,i=0,o=!1,s,n=!1,r=ge){kt(t),kt(e),Et(i),n||([t,e,i]=function(t,e,i=0){return[To(t),e.scale(me),i-be]}(t,e,i)),r.save(),r.translate(t.x+.5,t.y+.5),r.rotate(i),r.scale(o?-e.x:e.x,-e.y),s(r),r.restore()}function bo(t,e,i=1,o,s=0,n,r,a,c,l,h=0,d=ge){e=To(e),h-=be,So(t,e,i*=me,o,s*=me,n,r,a,c,l,h*=-1,d)}function mo(t,e,i=1,o,s=0,n,r,a,c,l,h=0){bo(t,e,i,o,s,n,r,a,c,l,h,fe)}function So(t,e,i=1,o=Kt,s=0,n=$t,r="center",a=Re,c="",l,h=0,d=fe){Pt(t),kt(e),Et(i),Vt(o),Et(s),Vt(n),["left","center","right"].includes(r),Pt(a),Pt(c),Et(h),d.fillStyle=o.toString(),d.strokeStyle=n.toString(),d.lineWidth=s,d.textAlign=r,d.font=c+" "+i+"px "+a,d.textBaseline="middle";const u=(t+"").split("\n"),f=e.y-(u.length-1)*i/2;d.save(),d.translate(e.x,f),d.rotate(-h);let p=0;u.forEach(t=>{s&&d.strokeText(t,0,p,l),d.fillText(t,0,p,l),p+=i}),d.restore()}function wo(t){let e=(t.x-so.x/2+.5)/me,i=(t.y-so.y/2+.5)/-me;if(be){const t=ht(-be),o=lt(-be),s=e*o+i*t;e=e*t-i*o,i=s}return new Ut(e+xe.x,i+xe.y)}function To(t){let e=t.x-xe.x,i=t.y-xe.y;if(be){const t=ht(be),o=lt(be),s=e*o+i*t;e=e*t-i*o,i=s}return new Ut(e*me+so.x/2-.5,i*-me+so.y/2-.5)}function Ao(t){let e=t.x/me,i=t.y/-me;if(be){const t=ht(-be),o=lt(-be),s=e*o+i*t;e=e*t-i*o,i=s}return new Ut(e,i)}function Co(t){let e=t.x,i=t.y;if(be){const t=ht(be),o=lt(be),s=e*o+i*t;e=e*t-i*o,i=s}return new Ut(e*me,i*-me)}function Lo(t,e,i=0){return[wo(t),e.scale(1/me),i+be]}function Do(){return so.scale(1/me)}function Ro(t=!1,e){on=t,e||=ge,e.globalCompositeOperation=t?"lighter":"source-over"}function Eo(){Mn(de),de.drawImage(ue,0,0),An(),ue.width|=0}function Po(){return!!document.fullscreenElement}function Go(){const t=he.parentElement;Po()?document.exitFullscreen&&document.exitFullscreen():t.requestFullscreen&&t.requestFullscreen()}function Mo(t="auto"){he.parentElement.style.cursor=t}class Oo{constructor(t,e=jt(8),i=jt(0,1)){oo||(oo=new Image,oo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||oo,this.tileSize=e,this.paddingSize=i}drawText(t,e,i=1,o,s=ge){this.drawTextScreen(t,To(e).floor(),i*me|0,o,s)}drawTextOverlay(t,e,i=4,o){this.drawText(t,e,i,o,fe)}drawTextScreen(t,e,i=4,o=!0,s=fe){s.save();const n=this.tileSize,r=n.add(this.paddingSize).scale(i),a=this.image.width/this.tileSize.x|0;(t+"").split("\n").forEach((t,c)=>{const l=o?t.length*n.x*i/2|0:0;for(let o=t.length;o--;){let h=t[o].charCodeAt(0);(h<32||h>127)&&(h=127);const d=h-32,u=d%a,f=d/a|0,p=e.add(jt(o,c).multiply(r));s.drawImage(this.image,u*n.x,f*n.y,n.x,n.y,p.x-l,p.y,n.x*i,n.y*i)}}),s.restore()}}let _o=jt(),Fo=jt(),Bo=jt(),Jo=jt(),zo=0,Io=!0,jo=!1,ko=!0,Wo=0;function No(t){ko=t}function Uo(t,e=0,i=!0,o=!0,s=!0){ds[e]&&(ds[e][t]&=~((i?1:0)|(o?2:0)|(s?4:0)))}function Ho(){ds.length=0,ds[0]=[],ys.length=0,vs.length=0,us.length=0,fs.length=0}function qo(t,e=0){return Pt(t),!!(1&ds[e]?.[t])}function Vo(t,e=0){return Pt(t),!!(2&ds[e]?.[t])}function Yo(t,e=0){return Pt(t),!!(4&ds[e]?.[t])}function Xo(t="ArrowUp",e="ArrowDown",i="ArrowLeft",o="ArrowRight"){Pt(t),Pt(e),Pt(i),Pt(o);const s=t=>qo(t)?1:0;return jt(s(o)-s(i),s(t)-s(e))}function Ko(t){return Et(t),qo(t)}function Qo(t){return Et(t),Vo(t)}function $o(t){return Et(t),Yo(t)}function Zo(t,e=Wo){return Et(t),Et(e),qo(t,e+1)}function ts(t,e=Wo){return Et(t),Et(e),Vo(t,e+1)}function es(t,e=Wo){return Et(t),Et(e),Yo(t,e+1)}function is(t,e=Wo){return Et(t),Et(e),us[e]?.[t]??jt()}function os(t=Wo){return Et(t),fs[t]??jt()}function ss(t=Wo){return Et(t),!!ds[t+1]}const ns=!Pe&&void 0!==window.ontouchstart;function rs(t=100){Et(t)||Gt(t),ti&&!Pe&&navigator&&navigator.vibrate&&navigator.vibrate(t)}function as(){rs(0)}function cs(){!ns&&he.requestPointerLock?.()}function ls(){document.exitPointerLock?.()}function hs(){return document.pointerLockElement===he}const ds=[[]],us=[],fs=[],ps=[],gs=new le,ys=[],vs=[];function xs(){Pe||(Ve&&ns||document.hasFocus()||Ho(),_o=wo(Fo),Bo=Ao(Jo),function(){const t=t=>{const e=t=>t>.3?gt(t,.3,.8):t<-.3?-gt(-t,.3,.8):0;return jt(e(t.x),e(-t.y)).clampLength()};if(Ye&&ns){if(!gs.isSet())return;Wo=0;const e=us[0]??(us[0]=[]),i=fs[0]??(fs[0]=jt());e[0]=jt(),i.set();const o=vs[0]??jt();if(Qe)e[0]=t(o);else if(o.lengthSquared()>.3){const t=pt(ot(o.x),-1,1),s=pt(ot(o.y),-1,1);i.set(t,-s),e[0]=i.clampLength()}const s=vs[1]??jt();1===Ke&&(e[1]=t(s));const n=ds[1]??(ds[1]=[]);for(let t=10;t--;){const e=Zo(t,0);n[t]=ys[t]?e?1:3:e?4:0}return}if(!Ue||!navigator||!navigator.getGamepads)return;if(!E&&!document.hasFocus())return;const e=navigator.getGamepads(),i=st(8,e.length);for(let o=0;o<i;++o){const i=e[o];if(!i){ds[o+1]=void 0,us[o]=void 0,fs[o]=void 0,ps[o]=void 0;continue}const s=ds[o+1]??(ds[o+1]=[]),n=us[o]??(us[o]=[]),r=fs[o]??(fs[o]=jt());for(let e=0;e<i.axes.length-1;e+=2)n[e>>1]=t(jt(i.axes[e],i.axes[e+1]));let a=!1;for(let t=i.buttons.length;t--;){const e=i.buttons[t],n=Zo(t,o);s[t]=e.pressed?n?1:3:n?4:0,e.pressed&&(!e.value||e.value>.9)&&(a=!0)}if(a&&(ps[o]=!0,ps[Wo]||(Wo=o),jo||=Wo===o),"standard"===i.mapping)r.set((Zo(15,o)&&1)-(Zo(14,o)&&1),(Zo(12,o)&&1)-(Zo(13,o)&&1));else if(i.axes&&i.axes.length>=2){const t=pt(ot(i.axes[0]),-1,1),e=pt(ot(i.axes[1]),-1,1);r.set(t,-e)}He&&!r.isZero()&&(n[0]=r.clampLength())}Ye&&jo&&gs.unset()}())}function bs(){if(!Pe){for(const t of ds)for(const e in t)t[e]&=1;zo=0,Bo=jt(),Jo=jt()}}function ms(){const t=so.subtract(jt($e));return 2===Ke&&(t.x+=$e/2),t}let Ss,ws=new AudioContext;const Ts=44100;function As(){return"running"===ws.state}class Cs{constructor(t,e=oi,i=si){if(ei&&!Pe&&(!t||Gt(t),Et(e),Et(i),this.range=e,this.taper=i,this.randomness=0,this.sampleRate=Ts,this.loadedPercent=0,t)){const e=1,i=.05;this.randomness=void 0!==t[e]?t[e]:i,t[e]=0,this.sampleChannels=[Os(...t)],this.loadedPercent=1}}play(t,e=1,i=1,o=1,s=!1,n=!1){if(!t||kt(t),Et(e),Et(i),Et(o),!ei||Pe)return;if(!this.sampleChannels)return;let r;if(t){const i=this.range;if(i){const o=xe.distanceSquared(t);if(o>i*i)return;e*=gt(o**.5,i,i*this.taper)}r=2*To(t).x/he.width-1}const a=i+i*this.randomness*o*Mt(-1,1);return new Ds(this,e,a,r,s,n)}playMusic(t=1,e=!0,i=!1){return this.play(void 0,t,1,0,e,i)}playNote(t=0,e,i){Et(t);const o=Ps(t,1);return this.play(e,i,o,0)}getDuration(){return this.sampleChannels&&this.sampleRate?this.sampleChannels[0].length/this.sampleRate:0}isLoaded(){return 1===this.loadedPercent}}class Ls extends Cs{constructor(t,e=0,i,o,s){super(void 0,i,o),ei&&!Pe&&(!t||Pt(t),Et(e),this.onloadCallback=s,this.randomness=e,t&&this.loadSound(t))}async loadSound(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to load sound from ${t}: ${e.status} ${e.statusText}`);const i=await e.arrayBuffer(),o=await ws.decodeAudioData(i),s=o.numberOfChannels,n=[];for(let t=0;t<s;t++){const e=o.getChannelData(t),i=e.length;n[t]=new Array(i);let r=0;for(;r<i;){await new Promise(t=>setTimeout(t,0));const o=st(r+1e5,i);for(;r<o;r++)n[t][r]=e[r];const a=s*i,c=t*i+r;this.loadedPercent=c/a}}this.sampleRate=o.sampleRate,this.sampleChannels=n,this.loadedPercent=1,this.onloadCallback&&this.onloadCallback(this)}}class Ds{constructor(t,e=1,i=1,o=0,s=!1,n=!1){Et(o),this.sound=t,this.volume=e,this.rate=i,this.pan=o,this.loop=s,this.pausedTime=0,this.startTime=void 0,this.gainNode=void 0,this.source=void 0,this.onendedCallback=t=>{t===this.source&&(this.source=void 0)},n||this.start()}start(t=0){this.isPlaying()&&this.stop(),this.gainNode=ws.createGain(),this.source=Gs(this.sound.sampleChannels,this.volume,this.rate,this.pan,this.loop,this.sound.sampleRate,this.gainNode,t,this.onendedCallback),this.source?(this.startTime=ws.currentTime-t,this.pausedTime=void 0):(this.startTime=void 0,this.pausedTime=0)}setVolume(t){this.volume=t,this.gainNode&&(this.gainNode.gain.value=t)}stop(t=0){if(this.isPlaying())if(t){const e=ws.currentTime,i=e+t;this.gainNode.gain.linearRampToValueAtTime(1,e),this.gainNode.gain.linearRampToValueAtTime(0,i),this.source.stop(i)}else this.source.stop();this.pausedTime=0,this.source=void 0,this.startTime=void 0}pause(){this.isPaused()||(this.pausedTime=this.getCurrentTime(),this.source.stop(),this.source=void 0,this.startTime=void 0)}resume(){this.isPaused()&&this.start(this.pausedTime)}isPlaying(){return!!this.source}isPaused(){return!this.isPlaying()}getCurrentTime(){const t=ft(ws.currentTime-this.startTime,this.getDuration());return this.isPlaying()?t:this.pausedTime}getDuration(){return this.rate?this.sound.getDuration()/this.rate:0}getSource(){return this.source}}function Rs(t,e="",i=1,o=1,s=1){if(!ei||Pe)return;if(!speechSynthesis)return;const n=new SpeechSynthesisUtterance(t);return n.lang=e,n.volume=2*i*ii,n.rate=o,n.pitch=s,speechSynthesis.speak(n),n}function Es(){speechSynthesis&&speechSynthesis.cancel()}function Ps(t,e=220){return e*2**(t/12)}function Gs(t,e=1,i=1,o=0,s=!1,n=Ts,r,a=0,c){if(!ei||Pe)return;if(!As())return void ws.resume();const l=t.length,h=t[0].length,d=ws.createBuffer(l,h,n),u=ws.createBufferSource();t.forEach((t,e)=>d.getChannelData(e).set(t)),u.buffer=d,u.playbackRate.value=i,u.loop=s,(r=r||ws.createGain()).gain.value=e,r.connect(Ss);const f=new StereoPannerNode(ws,{pan:pt(o,-1,1)});u.connect(f).connect(r),c&&u.addEventListener("ended",()=>c(u));const p=a*i;return u.start(0,p),u}function Ms(...t){return Gs([Os(...t)])}function Os(t=1,e=.05,i=220,o=0,s=0,n=.1,r=0,a=1,c=0,l=0,h=0,d=0,u=0,f=0,p=0,g=0,y=0,v=1,x=0,b=0,m=0){let S,w,T=Ts,A=2*Z,C=c*=500*A/T/T,L=i*=(1+Mt(e,-e))*A/T,D=0,R=0,E=0,P=1,G=[],M=0,O=0,_=0,F=A*tt(m)*2/T,B=ht(F),J=lt(F)/2/2,z=1+J,I=-2*B/z,j=(1-J)/z,k=(1+rt(m)*B)/2/z,W=-(rt(m)+B)/z,N=k,U=0,H=0,q=0,V=0;for(l*=500*A/T**3,p*=A/T,h*=A/T,d*=T,u=u*T|0,S=(o=o*T||9)+(x*=T)+(s*=T)+(n*=T)+(y*=T)|0;O<S;G[O++]=_*t)++E%(100*g|0)||(_=r?r>1?r>2?r>3?r>4?M/A%1<a/2?1:-1:lt(M**3):nt(st(dt(M),1),-1):1-(2*M/A%2+2)%2:1-4*tt(ot(M/A)-M/A):lt(M),_=(u?1-b+b*lt(A*O/u):1)*(r>4?_:rt(_)*tt(_)**a)*(O<o?O/o:O<o+x?1-(O-o)/x*(1-v):O<o+x+s?v:O<S-y?(S-O-y)/n*v:0),_=y?_/2+(y>O?0:(O<S-y?1:(S-O)/y)*G[O-y|0]/2/t):_,m&&(_=V=N*U+W*(U=H)+k*(H=_)-j*q-I*(q=V))),w=(i+=c+=l)*ht(p*D++),M+=w+w*f*lt(O**5),P&&++P>d&&(i+=h,L+=h,P=0),!u||++R%u||(i=L,c=C,P||=1);return G}const _s=[];function Fs(t){for(const e of _s)if(t.arrayCheck(e.size))return e.getCollisionData(t);return 0}function Bs(t,e=jt(),i,o=!0){for(const s of _s)if((!o||s.isSolid)&&s.collisionTest(t,e,i))return s}function Js(t,e,i,o,s=!0){for(const n of _s)if(!s||n.isSolid){const s=n.collisionRaycast(t,e,i,o);if(s)return s}}function zs(t,e=ro(),i=0,o,s=!0){if(!t){const e=50;(t={}).height=t.width=e,t.layers=[{}],t.layers[0].data=new Array(e*e).fill(0)}t.width&&t.height,t.layers&&t.layers.length;const n=[],r=jt(t.width,t.height),a=t.layers.length;for(let c=a;c--;){const l=t.layers[c];_(l.data&&l.data.length),_((r.area(),l.data.length));const h=i-(a-1-c),d=new Ws(jt(),r,e,h);n[c]=d;const u=l.tintcolor?(new Xt).setHex(l.tintcolor):l.color||Kt;_(Vt(u));for(let t=r.x;t--;)for(let e=r.y;e--;){const i=jt(t,r.y-1-e),s=l.data[t+e*r.x];if(s){const t=new Is(s-1,0,!1,u);d.setData(i,t),c===o&&d.setCollisionData(i,1)}}s&&d.redraw()}return n}class Is{constructor(t,e=0,i=!1,o=new Xt){this.tile=t,this.direction=e,this.mirror=i,this.color=o.copy()}clear(){this.tile=this.direction=0,this.mirror=!1,this.color=new Xt}}class js extends eo{constructor(t,e,i=0,o=0,s=jt(512)){kt(s),super(t,e,void 0,i,Kt,o),this.canvas=Pe?void 0:new OffscreenCanvas(s.x,s.y),this.context=this.canvas?.getContext("2d"),this.textureInfo=new co(this.canvas,!1),this.refreshWebGL=!1,this.mass=this.gravityScale=this.friction=this.restitution=0}destroy(){this.destroyed||(this.textureInfo.destroyWebGLTexture(),super.destroy())}render(){this.draw(this.pos,this.size,this.angle,this.color,this.mirror,this.additiveColor)}draw(t,e,i=0,o=Kt,s=!1,n,r=!1,a){const c=Ge&&this.textureInfo.hasWebGL();c&&this.refreshWebGL&&(this.textureInfo.createWebGLTexture(),this.refreshWebGL=!1),lo(t,e,(new ao).setFullImage(this.textureInfo),o,i,s,n,c,r,a)}drawCanvas2D(t,e,i,o,s){if(!this.context)return;const n=this.context;n.save(),t=t.subtract(this.pos).multiply(this.tileInfo.size),e=e.multiply(this.tileInfo.size),n.translate(t.x,this.canvas.height-t.y),n.rotate(i),n.scale(o?-e.x:e.x,e.y),s(n),n.restore()}drawTile(t,e=jt(1),i,o=new Xt,s,n){this.drawCanvas2D(t,e,s,n,t=>{const e=i&&i.textureInfo;e?(t.globalAlpha=o.a,t.drawImage(e.image,i.pos.x,i.pos.y,i.size.x,i.size.y,-.5,-.5,1,1),t.globalAlpha=1):(t.fillStyle=o.toString(),t.fillRect(-.5,-.5,1,1))})}drawRect(t,e,i,o){this.drawTile(t,e,void 0,i,o)}useWebGL(t=!0,e=!1){!e&&t&&this.textureInfo.hasWebGL()?this.refreshWebGL=!0:t?this.textureInfo.createWebGLTexture():this.textureInfo.destroyWebGLTexture()}}class ks extends js{constructor(t,e,i=ro(),o=0){const s=i?e.multiply(i.size):e;super(t,e,0,o,s),this.tileInfo=i,this.data=[];for(let t=this.size.area();t--;)this.data.push(new Is);Pe&&(this.redraw=()=>{},this.render=()=>{},this.redrawStart=()=>{},this.redrawEnd=()=>{},this.drawTileData=()=>{},this.drawCanvas2D=()=>{},this.useWebGL=()=>{})}setData(t,e,i=!1){kt(t),t.arrayCheck(this.size)&&(this.data[(0|t.y)*this.size.x+t.x|0]=e,i&&this.drawTileData(t))}getData(t){return kt(t),t.arrayCheck(this.size)&&this.data[(0|t.y)*this.size.x+t.x|0]}render(){this.context,this.refreshWebGL&&(this.textureInfo.createWebGLTexture(),this.refreshWebGL=!1);const t=(new ao).setFullImage(this.textureInfo),e=this.drawSize||this.size,i=this.pos.add(e.scale(.5)),o=Ge&&this.textureInfo.hasWebGL();lo(i,e,t,Kt,0,!1,Zt,o)}redraw(){this.redrawStart(!0);for(let t=this.size.x;t--;)for(let e=this.size.y;e--;)this.drawTileData(jt(t,e),!1);this.redrawEnd(),this.useWebGL()}redrawStart(t=!1){if(!this.context)return;this.savedRenderSettings=[pe,ge,so,xe,me],pe=this.canvas,ge=this.context,xe=this.size.scale(.5);const e=this.tileInfo?this.tileInfo.size:jt(1);me=e.x,so=this.size.multiply(e),t&&(pe.width=so.x,pe.height=so.y),this.context.imageSmoothingEnabled=!De,Tn()}redrawEnd(){this.context&&(this.context,Mn(ge),[pe,ge,so,xe,me]=this.savedRenderSettings)}drawTileData(t,e=!0){if(!this.context)return;const i=this.tileInfo.size;if(e){const e=t.multiply(i);this.context.clearRect(e.x,this.canvas.height-e.y,i.x,-i.y)}const o=this.getData(t);if(void 0!==o.tile){this.context;const e=t.add(jt(.5)),s=ro(o.tile,i,this.tileInfo.textureIndex,this.tileInfo.padding);lo(e,jt(1),s,o.color,o.direction*Z/2,o.mirror)}}}class Ws extends ks{constructor(t,e,i=ro(),o=0){super(t,e.floor(),i,o),this.collisionData=[],this.initCollision(this.size),_s.push(this),this.isSolid=!0}destroy(){if(this.destroyed)return;const t=_s.indexOf(this);t>=0&&_s.splice(t,1),super.destroy()}initCollision(t){kt(t),this.size=t.floor(),this.collisionData=[],this.collisionData.length=t.area(),this.collisionData.fill(0)}setCollisionData(t,e=1){kt(t);const i=(0|t.y)*this.size.x+t.x|0;t.arrayCheck(this.size)&&(this.collisionData[i]=e)}getCollisionData(t){kt(t);const e=(0|t.y)*this.size.x+t.x|0;return t.arrayCheck(this.size)?this.collisionData[e]:0}collisionTest(t,e=new Ut,i){kt(t)&&kt(e);const o=t.x-this.pos.x,s=t.y-this.pos.y,n=nt(o-e.x/2|0,0),r=nt(s-e.y/2|0,0),a=st(o+e.x/2,this.size.x),c=st(s+e.y/2,this.size.y),l=new Ut;for(let t=r;t<c;++t)for(let e=n;e<a;++e){const o=this.collisionData[t*this.size.x+e];if(o&&(!i||i.collideWithTile(o,l.set(e+this.pos.x,t+this.pos.y))))return!0}return!1}collisionRaycast(t,e,i,o){kt(t)&&kt(e);const s=new Ut,n=function(t,e,i,o){kt(t),kt(e),!o||kt(o);const s=e.x-t.x,n=e.y-t.y,r=at(s,n);if(!r)return;const a=t.floor(),c=s/r,l=n/r,h=rt(c),d=rt(l),u=c?tt(1/c):1/0,f=l?tt(1/l):1/0,p=h>0?a.x+1:a.x,g=d>0?a.y+1:a.y;let y=0,v=c?(p-t.x)/c:1/0,x=l?(g-t.y)/l:1/0,b=u<f;for(;y<r;){if(i(a)){const e=jt(t.x+c*y,t.y+l*y),i=1e-9;return b&&h<0&&(e.x-=i),d<0&&(e.y-=i),o&&(b?o.set(-h,0):o.set(0,-d)),e}(b=v<x)?(a.x+=h,y=v,v+=u):(a.y+=d,y=x,x+=f)}}(t,e,t=>{s.set(t.x-this.pos.x,t.y-this.pos.y);const e=this.getCollisionData(s);return e&&(!i||i.collideWithTile(e,t))},o);if(n)return n.floor().add(jt(.5)),M&&jt(1),M&&o&&n.add(o),n}}class Ns extends eo{constructor(t,e,i=0,o=0,s=100,n=Z,r,a=Kt,c=Kt,l=Qt,h=Qt,d=.5,u=.1,f=1,p=.1,g=.05,y=1,v=1,x=0,b=Z,m=.1,S=.2,w=!1,T=!1,A=!0,C=(T?1e9:0),L=!1){super(t,jt(),r,e,void 0,C),this.emitSize=i instanceof Ut?i.copy():i,this.emitTime=o,this.emitRate=s,this.emitConeAngle=n,this.colorStartA=a.copy(),this.colorStartB=c.copy(),this.colorEndA=l.copy(),this.colorEndB=h.copy(),this.randomColorLinear=A,this.particleTime=d,this.sizeStart=u,this.sizeEnd=f,this.speed=p,this.angleSpeed=g,this.damping=y,this.angleDamping=v,this.gravityScale=x,this.particleConeAngle=b,this.fadeRate=m,this.randomness=S,this.collideTiles=w,this.additive=T,this.localSpace=L,this.trailScale=0,this.particleDestroyCallback=void 0,this.particleCreateCallback=void 0,this.emitTimeBuffer=0,this.velocityInheritance=0,this.previousAngle=this.angle,this.previousPos=this.pos.copy()}updatePhysics(){}update(){if(this.velocityInheritance){const t=this.velocityInheritance;this.velocity.x=t*(this.pos.x-this.previousPos.x),this.velocity.y=t*(this.pos.y-this.previousPos.y),this.angleVelocity=t*(this.angle-this.previousAngle),this.previousAngle=this.angle,this.previousPos.x=this.pos.x,this.previousPos.y=this.pos.y}if(!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate&&Ne){const t=1/this.emitRate/Ne;for(this.emitTimeBuffer+=r;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy()}emitParticle(){let t="number"==typeof this.emitSize?Jt(this.emitSize/2):jt(Mt(-.5,.5),Mt(-.5,.5)).multiply(this.emitSize).rotate(this.angle),e=Mt(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),e+=this.angle);const i=this.randomness,o=t=>t+t*Mt(i,-i),s=o(this.particleTime),n=o(this.sizeStart),r=o(this.sizeEnd),a=o(this.speed),c=o(this.angleSpeed)*Ft(),l=Mt(this.emitConeAngle,-this.emitConeAngle),h=zt(this.colorStartA,this.colorStartB,this.randomColorLinear),d=zt(this.colorEndA,this.colorEndB,this.randomColorLinear),u=this.localSpace?l:this.angle+l,f=new Us(t,this.tileInfo,e,h,d,s,n,r,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback);return f.velocity=jt().setAngle(u,a),f.angleVelocity=c,!this.localSpace&&this.velocityInheritance>0&&(f.velocity.x+=this.velocity.x,f.velocity.y+=this.velocity.y,f.angleVelocity+=this.angleVelocity),f.fadeRate=this.fadeRate,f.damping=this.damping,f.angleDamping=this.angleDamping,f.restitution=this.restitution,f.friction=this.friction,f.gravityScale=this.gravityScale,f.collideTiles=this.collideTiles,f.renderOrder=this.renderOrder,f.mirror=_t(),this.particleCreateCallback&&this.particleCreateCallback(f),f}render(){}}class Us extends eo{constructor(t,e,i,o,s,n,r,a,c,l,h,d,u){super(t,jt(),e,i),this.colorStart=o,this.colorEnd=s,this.lifeTime=n,this.sizeStart=r,this.sizeEnd=a,this.fadeRate=c,this.additive=l,this.trailScale=h,this.localSpaceEmitter=d,this.destroyCallback=u,this.clampSpeed=!1}update(){if(this.collideTiles||this.collideSolidObjects){const t=this.velocity.lengthSquared();if(t>ke*ke){const e=ke/t**.5;this.velocity.x*=e,this.velocity.y*=e}}if(this.lifeTime>0&&h-this.spawnTime>this.lifeTime){const t=this.colorEnd;this.color.set(t.r,t.g,t.b,t.a),this.size.set(this.sizeEnd,this.sizeEnd),this.destroyCallback&&this.destroyCallback(this),this.destroyed=1}}render(){const t=this.lifeTime>0?st((h-this.spawnTime)/this.lifeTime,1):1,e=1-t,i=jt(e*this.sizeStart+t*this.sizeEnd);this.color.r=e*this.colorStart.r+t*this.colorEnd.r,this.color.g=e*this.colorStart.g+t*this.colorEnd.g,this.color.b=e*this.colorStart.b+t*this.colorEnd.b,this.color.a=e*this.colorStart.a+t*this.colorEnd.a;const o=this.fadeRate/2;this.color.a*=t<o?t/o:t>1-o?(1-t)/o:1,this.additive&&Ro(!0);let s=this.pos,n=this.angle;if(this.localSpaceEmitter){const t=this.localSpaceEmitter.angle,e=ht(t),i=lt(t);s=this.localSpaceEmitter.pos.add(new Ut(s.x*e-s.y*i,s.x*i+s.y*e)),n+=this.localSpaceEmitter.angle}if(this.trailScale){const t=this.localSpaceEmitter?this.velocity.rotate(-this.localSpaceEmitter.angle):this.velocity,e=t.length();if(e){const o=e*this.trailScale;i.y=nt(i.x,o),n=ut(t.x,t.y),lo(s,i,this.tileInfo,this.color,n,this.mirror)}}else lo(s,i,this.tileInfo,this.color,n,this.mirror);this.additive&&Ro()}}const Hs={};let qs,Vs,Ys,Xs,Ks=[];function Qs(t){var e;qs=t,O||(e=t=>t.unlocked=!!localStorage[t.storageKey()],Object.values(Hs).forEach(t=>e(t))),m(void 0,function(){if(!Ks.length)return;const t=Ks[0],e=d-Vs;if(Vs)if(e>ni)Vs=0,Ks.shift();else{const i=ni-ri,o=e<ri?1-e/ri:e>i?(e-i)/ri:0;t.render(o)}else Vs=d})}class $s{constructor(t,e,i="",o="",s){t>=0&&Hs[t],this.id=t,this.name=e,this.description=i,this.icon=o,this.unlocked=!1,s&&((this.image=new Image).src=s),Hs[t]=this}unlock(){ci||this.unlocked||(localStorage[this.storageKey()]=this.unlocked=!0,Ks.push(this))}render(t=0){const e=fe,i=st(ai.x,he.width),o=ai.y,s=ue.width-i,n=-o*t,r=qt(0,0,.9);e.save(),e.beginPath(),e.fillStyle=r.toString(),e.strokeStyle=$t.toString(),e.lineWidth=3,e.rect(s,n,i,o),e.fill(),e.stroke(),e.clip();const a=jt(.1,.05).scale(o),c=o-2*a.x;this.renderIcon(jt(s+a.x+c/2,n+o/2),c);const l=.5*o,h=.3*o,d=jt(s+c+2*a.x,n+2*a.y+l/2),u=i-c-3*a.x;So(this.name,d,l,$t,0,void 0,"left",void 0,void 0,u),d.y=n+o-2*a.y-h/2,So(this.description,d,h,$t,0,void 0,"left",void 0,void 0,u),e.restore()}renderIcon(t,e){this.image?fe.drawImage(this.image,t.x-e/2,t.y-e/2,e,e):So(this.icon,t,.7*e,$t)}storageKey(){return qs+"_"+this.id}}let Zs,tn,en,on,sn,nn,rn,an,cn,ln,hn,dn,un=!0,fn=!0;const pn=5e5,gn=11,yn=4*gn,vn=pn/yn|0,xn=3,bn=4*xn,mn=pn/bn|0;function Sn(){if(!en)return;Gn(),en=!1,Xs.useProgram(Zs);let t=0;const e=(e,i,o,s)=>{const n=Xs.getAttribLocation(Zs,e),r=o&&yn,a=o&&1,c=1===o;Xs.enableVertexAttribArray(n),Xs.vertexAttribPointer(n,s,i,c,r,t),Xs.vertexAttribDivisor(n,a),t+=s*o};Xs.bindBuffer(Xs.ARRAY_BUFFER,an),e("g",Xs.FLOAT,0,2),Xs.bindBuffer(Xs.ARRAY_BUFFER,rn),Xs.bufferData(Xs.ARRAY_BUFFER,pn,Xs.DYNAMIC_DRAW),e("p",Xs.FLOAT,4,4),e("u",Xs.FLOAT,4,4),e("c",Xs.UNSIGNED_BYTE,1,4),e("a",Xs.UNSIGNED_BYTE,1,4),e("r",Xs.FLOAT,4,1)}function wn(){if(en)return;Gn(),en=!0,Xs.useProgram(tn);let t=0;const e=(e,i,o,s)=>{const n=Xs.getAttribLocation(tn,e),r=1===o,a=bn;Xs.enableVertexAttribArray(n),Xs.vertexAttribPointer(n,s,i,r,a,t),Xs.vertexAttribDivisor(n,0),t+=s*o};Xs.bindBuffer(Xs.ARRAY_BUFFER,rn),Xs.bufferData(Xs.ARRAY_BUFFER,pn,Xs.DYNAMIC_DRAW),e("p",Xs.FLOAT,4,2),e("c",Xs.UNSIGNED_BYTE,1,4)}function Tn(){if(!Ge||!Xs)return;An();const t=jt(2*me).divide(so),e=xe.rotate(-be),i=jt(-1).subtract(e.multiply(t)),o=ht(be),s=lt(be),n=[t.x*o,t.y*s,0,0,-t.x*s,t.y*o,0,0,1,1,1,0,i.x,i.y,0,1],r=(t,e,i)=>{Xs.useProgram(t);const o=Xs.getUniformLocation(t,e);Xs.uniformMatrix4fv(o,!1,i)};r(tn,"m",n),r(Zs,"m",n),Xs.activeTexture(Xs.TEXTURE0),no[0]&&(nn=no[0].glTexture,Xs.bindTexture(Xs.TEXTURE_2D,nn)),on=sn=!1,en=!0,Sn()}function An(){Xs&&(Ys.width=pe.width,Ys.height=pe.height,Xs.viewport(0,0,Ys.width,Ys.height),Xs.clear(Xs.COLOR_BUFFER_BIT))}function Cn(t,e=!1){if(!Xs||t===nn)return;Gn(),nn=t,Xs.bindTexture(Xs.TEXTURE_2D,nn);const i=e?Xs.REPEAT:Xs.CLAMP_TO_EDGE;Xs.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_WRAP_S,i),Xs.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_WRAP_T,i)}function Ln(t,e){if(!Xs)return;const i=Xs.createShader(e);if(Xs.shaderSource(i,t),Xs.compileShader(i),E&&!Xs.getShaderParameter(i,Xs.COMPILE_STATUS))throw Xs.getShaderInfoLog(i);return i}function Dn(t,e){if(!Xs)return;const i=Xs.createProgram();if(Xs.attachShader(i,Ln(t,Xs.VERTEX_SHADER)),Xs.attachShader(i,Ln(e,Xs.FRAGMENT_SHADER)),Xs.linkProgram(i),E&&!Xs.getProgramParameter(i,Xs.LINK_STATUS))throw Xs.getProgramInfoLog(i);return i}function Rn(t){if(!Xs)return;const e=Xs.createTexture();let i=!1;if(t&&t.width)Pn(e,t),Xs.bindTexture(Xs.TEXTURE_2D,e),i=!De&&wt(t.width)&&wt(t.height);else{const t=new Uint8Array([255,255,255,255]);Xs.bindTexture(Xs.TEXTURE_2D,e),Xs.texImage2D(Xs.TEXTURE_2D,0,Xs.RGBA,1,1,0,Xs.RGBA,Xs.UNSIGNED_BYTE,t)}const o=De?Xs.NEAREST:Xs.LINEAR,s=i?Xs.LINEAR_MIPMAP_LINEAR:o;return Xs.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_MAG_FILTER,o),Xs.texParameteri(Xs.TEXTURE_2D,Xs.TEXTURE_MIN_FILTER,s),i&&Xs.generateMipmap(Xs.TEXTURE_2D),Xs.bindTexture(Xs.TEXTURE_2D,nn),e}function En(t){Xs&&Xs.deleteTexture(t)}function Pn(t,e){Xs&&(!!e&&e.width,Xs.bindTexture(Xs.TEXTURE_2D,t),Xs.texImage2D(Xs.TEXTURE_2D,0,Xs.RGBA,Xs.RGBA,Xs.UNSIGNED_BYTE,e),Xs.bindTexture(Xs.TEXTURE_2D,nn))}function Gn(){if(Ge&&Xs&&hn){const t=sn?Xs.ONE:Xs.ONE_MINUS_SRC_ALPHA;Xs.blendFuncSeparate(Xs.SRC_ALPHA,t,Xs.ONE,t),Xs.enable(Xs.BLEND);const e=hn*(en?xn:gn);Xs.bufferSubData(Xs.ARRAY_BUFFER,0,cn,0,e),en?Xs.drawArrays(Xs.TRIANGLE_STRIP,0,hn):Xs.drawArraysInstanced(Xs.TRIANGLE_STRIP,0,4,hn),io+=hn,hn=0}sn=on}function Mn(t){Ge&&Xs&&(Gn(),t.drawImage(Ys,0,0))}function On(t=!0){un=t}function _n(t,e,i,o,s=0,n=0,r=0,a=1,c=1,l=-1,h=0){(hn>=vn||sn!==on)&&Gn(),Sn(),en=!1;let d=hn++*gn;cn[d++]=t,cn[d++]=e,cn[d++]=i,cn[d++]=o,cn[d++]=n,cn[d++]=r,cn[d++]=a,cn[d++]=c,ln[d++]=l,ln[d++]=h,cn[d++]=s}function Fn(t,e,i,o,s,n,r,a=!0){const c=[];for(const e of t){const t=e.x*s,a=e.y*n,l=lt(-r),h=ht(-r);c.push(jt(i+h*t-l*a,o+l*t+h*a))}const l=a?function(t){if(t.length<3)return[];const e=(t,e,i)=>(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x);(t=>{let e=0;for(let i=t.length;i--;){const o=(i+1)%t.length;e+=t[i].cross(t[o])}return e})(t)<0&&(t=t.reverse());const i=1e-9,o=(t,o,s,n)=>{const r=e(o,s,t),a=e(s,n,t),c=e(n,o,t);return!((r<-i?1:0)+(a<-i?1:0)+(c<-i?1:0)&&(r>i?1:0)+(a>i?1:0)+(c>i?1:0))},s=[];for(let e=0;e<t.length;++e)s[e]=e;const n=[];let r=0;const a=t.length**2+100;for(;s.length>3&&r++<a;){let r=!1;for(let a=0;a<s.length;a++){const c=s[(a+s.length-1)%s.length],l=s[a],h=s[(a+1)%s.length],d=t[c],u=t[l],f=t[h];if(e(d,u,f)<i)continue;let p=!1;for(let e=0;e<s.length;e++){const i=s[e];if(i!==c&&i!==l&&i!==h&&(p=o(t[i],d,u,f),p))break}if(!p){n.push([c,l,h]),s.splice(a,1),r=!0;break}}if(!r){let i=-1,o=1/0;for(let n=0;n<s.length;n++){const r=s[(n+s.length-1)%s.length],a=s[n],c=s[(n+1)%s.length],l=tt(e(t[r],t[a],t[c]));l<o&&(o=l,i=n)}if(i<0)break;const r=s[(i+s.length-1)%s.length],a=s[i],c=s[(i+1)%s.length];n.push([r,a,c]),s.splice(i,1)}}if(3===s.length&&n.push([s[0],s[1],s[2]]),!n.length)return[];const c=[];let[l,h,d]=n[0];c.push(t[l],t[h],t[d]);for(let e=1;e<n.length;e++){const[i,o,s]=n[e];c.push(t[d],t[i]),c.push(t[i],t[o],t[s]),d=s}return c}(c):c;Jn(l,e)}function Bn(t,e,i,o,s,n,r,a,c=!0){const l=function(t,e,i=!0){if(t.length<2)return[];const o=e/2,s=[],n=t.length,r=1e-6,a=100*e;for(let e=0;e<n;e++){const c=t[i?(e-1+n)%n:nt(e-1,0)],l=t[e],h=t[i?(e+1)%n:st(e+1,n-1)],d=l.x-c.x,u=l.y-c.y,f=(d*d+u*u)**.5,p=h.x-l.x,g=h.y-l.y,y=(p*p+g*g)**.5;if(f<r&&y<r)continue;const v=f>r?-u/f:0,x=f>r?d/f:0;let b=v+(y>r?-g/y:0),m=x+(y>r?p/y:0);const S=(b*b+m*m)**.5;if(S<r)b=v,m=x;else{b/=S,m/=S;const t=v*b+x*m;if(t>r){const e=st(1/t,a);b*=e,m*=e}}const w=jt(l.x-b*o,l.y-m*o),T=jt(l.x+b*o,l.y+m*o);s.push(w),s.push(T)}return s.length>1&&i&&(s.push(s[0]),s.push(s[1])),s}(t,i,c);Fn(l,e,o,s,n,r,a,!1)}function Jn(t,e){if(!Ge||t.length<3)return;const i=t.length+2;(hn+i>=mn||sn!==on)&&Gn(),wn();let o=hn*xn;for(let s=i;s--;){const n=t[pt(s-1,0,i-3)];cn[o++]=n.x,cn[o++]=n.y,ln[o++]=e}hn+=i}function zn(t,e){if(!Ge||t.length<3)return;const i=t.length+2;(hn+i>=mn||sn!==on)&&Gn(),wn();let o=hn*xn;for(let s=i;s--;){const n=pt(s-1,0,i-3),r=t[n],a=e[n];cn[o++]=r.x,cn[o++]=r.y,ln[o++]=a}hn+=i}let In,jn,kn;class Wn extends $s{constructor(t,e,i,o,s){super(t,e,i,o,s)}unlock(){super.unlock(),In&&In.unlockMedal(this.id)}}class Nn{constructor(t,e,i){In=this,this.app_id=t,this.cipher=e,this.cryptoJS=i,this.host=location?location.hostname:"";const o=new URL(location.href);if(this.session_id=o.searchParams.get("ngio_session_id"),!this.session_id)return;const s=this.call("Medal.getList");this.medals=s?s.result.data.medals:[],O&&this.medals;for(const t of this.medals){const e=Hs[t.id];e&&(e.image=new Image,e.image.src=t.icon,e.name=t.name,e.description=t.description,e.unlocked=t.unlocked,e.difficulty=t.difficulty,e.value=t.value,e.value&&(e.description=e.description+` (${e.value})`))}const n=this.call("ScoreBoard.getBoards");this.scoreboards=n?n.result.data.scoreboards:[],O&&this.scoreboards,setInterval(()=>this.call("Gateway.ping",0,!0),6e4)}unlockMedal(t){return this.call("Medal.unlock",{id:t},!0)}postScore(t,e){return this.call("ScoreBoard.postScore",{id:t,value:e},!0)}getScores(t,e,i=0,o=0,s=10){return this.call("ScoreBoard.getScores",{id:t,user:e,social:i,skip:o,limit:s})}logView(){return this.call("App.logView",{host:this.host},!0)}call(t,e,i=!1){const o={component:t,parameters:e};if(this.cipher){const t=this.cryptoJS,e=t.enc.Base64.parse(this.cipher),i=t.lib.WordArray.random(16),s=t.AES.encrypt(JSON.stringify(o),e,{iv:i});o.secure=t.enc.Base64.stringify(i.concat(s.ciphertext)),o.parameters=0}const s={app_id:this.app_id,session_id:this.session_id,call:o},n=new FormData;n.append("input",JSON.stringify(s));const r=new XMLHttpRequest;r.open("POST","https://newgrounds.io/gateway_v3.php",!O&&i);try{r.send(n)}catch(t){return}return O&&r.responseText,r.responseText&&JSON.parse(r.responseText)}}class Un{constructor(t,e=!1,i=!0){function o(){Pe||(Ge?(jn.texture=Rn(),jn.shader=Dn("#version 300 es\nprecision highp float;in vec2 p;void main(){gl_Position=vec4(p+p-1.,1,1);}","#version 300 es\nprecision highp float;uniform sampler2D iChannel0;uniform vec3 iResolution;uniform float iTime;out vec4 c;\n"+t+"\nvoid main(){mainImage(c,gl_FragCoord.xy);c.a=1.;}")):console.warn("PostProcessPlugin: WebGL not enabled!"))}jn=this,t||(t="void mainImage(out vec4 c,vec2 p){c=texture(iChannel0,p/iResolution.xy);}"),this.shader=void 0,this.texture=void 0,o(),m(void 0,function(){if(Pe)return;if(!Ge)return;Gn(),(i||e)&&(de.drawImage(Ys,0,0),e&&(de.drawImage(ue,0,0),ue.width|=0)),Xs.useProgram(jn.shader),Xs.bindBuffer(Xs.ARRAY_BUFFER,an),Xs.pixelStorei(Xs.UNPACK_FLIP_Y_WEBGL,1),Xs.disable(Xs.BLEND),Xs.activeTexture(Xs.TEXTURE0),Xs.bindTexture(Xs.TEXTURE_2D,jn.texture),(i||e)&&Xs.texImage2D(Xs.TEXTURE_2D,0,Xs.RGBA,Xs.RGBA,Xs.UNSIGNED_BYTE,he);const t=Xs.getAttribLocation(jn.shader,"p");Xs.enableVertexAttribArray(t),Xs.vertexAttribPointer(t,2,Xs.FLOAT,!1,8,0);const o=t=>Xs.getUniformLocation(jn.shader,t);Xs.uniform1i(o("iChannel0"),0),Xs.uniform1f(o("iTime"),h),Xs.uniform3f(o("iResolution"),he.width,he.height,1),Xs.drawArrays(Xs.TRIANGLE_STRIP,0,4)},function(){jn.shader=void 0,jn.texture=void 0},function(){o()})}}class Hn extends Cs{constructor(t){super(void 0),ei&&!Pe&&(this.randomness=0,this.sampleChannels=function(t,e,i,o=125){let s,n,r,a,c,l,h,d,u,f,p,g,y,v,x=0,b=[],m=[],S=[],w=0,T=0,A=1,C={},L=Ts/o*60>>2;for(;A;w++)b=[A=d=g=0],i.forEach((o,D)=>{for(h=e[o][w]||[0,0,0],A|=e[o][w]&&1,v=g+(e[o][0].length-2-(d?0:1))*L,y=D===i.length-1,s=2,r=g;s<h.length+y;d=++s){for(c=h[s],u=s===h.length+y-1&&y||f!==(h[0]||0)||0|c,n=0;n<L&&d;n++>L-99&&u&&p<1?p+=1/99:0)l=(1-p)*b[x++]/2||0,m[r]=(m[r]||0)-l*T+l,S[r]=(S[r++]||0)+l*T+l;c&&(p=c%1,T=h[1]||0,(c|=0)&&(b=C[[f=h[x=0]||0,c]]=C[[f,c]]||(a=[...t[f]],a[2]=(a[2]||220)*2**(c/12-1),c>0?Os(...a):[])))}g=v});return[m,S]}(...t),this.sampleRate=Ts)}playMusic(t=1,e=!0){return super.play(void 0,t,1,0,e)}}let qn,Vn=0;function Yn(t){Vn="boolean"==typeof t?t?1:0:t}class Xn{constructor(t=fe){function e(t){t.parent&&(t.pos.x=t.localPos.x+t.parent.pos.x,t.pos.y=t.localPos.y+t.parent.pos.y)}kn=this,this.defaultColor=Kt,this.defaultLineColor=$t,this.defaultTextColor=$t,this.defaultButtonColor=qt(0,0,.7),this.defaultHoverColor=qt(0,0,.9),this.defaultDisabledColor=qt(0,0,.3),this.defaultGradientColor=void 0,this.defaultLineWidth=4,this.defaultCornerRadius=0,this.defaultTextFitScale=.8,this.defaultFont=Re,this.defaultSoundPress=void 0,this.defaultSoundRelease=void 0,this.defaultSoundClick=void 0,this.defaultShadowColor=Zt,this.defaultShadowBlur=5,this.defaultShadowOffset=jt(5),this.nativeHeight=0,this.navigationObject=void 0,this.navigationGamepadIndex=0,this.navigationTimer=new le(void 0,!0),this.navigationDelay=.2,this.navigationDirection=1,this.navigationMode=!1,this.uiObjects=[],this.uiContext=t,this.activeObject=void 0,this.hoverObject=void 0,this.lastHoverObject=void 0,this.confirmDialog=void 0,m(function(){kn.activeObject&&!kn.activeObject.visible&&(kn.activeObject=void 0),kn.lastHoverObject=kn.hoverObject,kn.hoverObject=void 0,Qo(0)&&(kn.navigationMode=!1,kn.navigationObject=void 0);const t=kn.getNavigableObjects();if(t.length){if(t.includes(kn.navigationObject)||(kn.navigationObject=void 0),ns||kn.navigationMode&&!kn.navigationObject&&(kn.navigationObject=t.find(t=>t.navigationAutoSelect)),!kn.navigationTimer.active()){const e=rt(kn.getNavigationDirection());if(e){let i;if(kn.navigationObject){const o=t.indexOf(kn.navigationObject);i=t[ft(o+e,t.length)]}else i=t.find(t=>t.navigationAutoSelect),i||(i=t[e>0?0:t.length-1]);kn.navigationObject!==i&&(kn.navigationMode=!0,kn.hoverObject=void 0,kn.navigationObject=i,kn.navigationTimer.set(kn.navigationDelay),i.soundPress&&i.soundPress.play())}}kn.navigationObject&&kn.getNavigationWasPressed()&&kn.navigationObject.navigatePressed()}else kn.navigationObject=void 0;for(let t=kn.uiObjects.length;t--;){const e=kn.uiObjects[t];e.parent||i(e)}function i(t){if(t.visible){e(t);for(let e=t.children.length;e--;)i(t.children[e]);t.update()}}kn.uiObjects=kn.uiObjects.filter(t=>!t.destroyed)},function(){const t=kn.uiContext;if(t.save(),kn.nativeHeight){const o=so.y/kn.nativeHeight;t.translate(-o*so.x/2,0),t.scale(o,o),t.translate(so.x/2/o,0)}function i(t){if(t.visible){e(t),t.render();for(const e of t.children)i(e)}}if(kn.uiObjects.forEach(t=>t.parent||i(t)),Vn>0){function s(t,i=!0){i&&=!!t.visible,e(t),t.renderDebug(i);for(const e of t.children)s(e,i)}kn.uiObjects.forEach(t=>t.parent||s(t))}t.restore()})}drawRect(t,e,i=Kt,o=0,s=$t,n=0,r,a=$t,c=0,l=jt()){kt(t),kt(e),Vt(i),Et(o),Vt(s),Et(n);const h=kn.uiContext;if(r){const o=h.createLinearGradient(t.x,t.y-e.y/2,t.x,t.y+e.y/2),s=i.toString();o.addColorStop(0,s),o.addColorStop(.5,r.toString()),o.addColorStop(1,s),h.fillStyle=o}else h.fillStyle=i.toString();(c||l.x||l.y)&&a.a>0&&(h.shadowColor=a.toString(),h.shadowBlur=c,h.shadowOffsetX=l.x,h.shadowOffsetY=l.y),h.beginPath(),n&&h.roundRect?h.roundRect(t.x-e.x/2,t.y-e.y/2,e.x,e.y,n):h.rect(t.x-e.x/2,t.y-e.y/2,e.x,e.y),h.fill(),h.shadowColor="#0000",o&&s.a>0&&(h.strokeStyle=s.toString(),h.lineWidth=o,h.stroke())}drawLine(t,e,i=kn.defaultLineWidth,o=kn.defaultLineColor){kt(t),kt(e),Et(i),Vt(o);const s=kn.uiContext;s.strokeStyle=o.toString(),s.lineWidth=i,s.beginPath(),s.lineTo(t.x,t.y),s.lineTo(e.x,e.y),s.stroke()}drawTile(t,e,i,o=kn.defaultColor,s=0,n=!1,r=$t,a=0,c=jt()){const l=kn.uiContext;(a||c.x||c.y)&&r.a>0&&(l.shadowColor=r.toString(),l.shadowBlur=a,l.shadowOffsetX=c.x,l.shadowOffsetY=c.y),lo(t,e,i,o,s,n,Zt,!1,!0,l),l.shadowColor="#0000"}drawText(t,e,i,o=kn.defaultColor,s=kn.defaultLineWidth,n=kn.defaultLineColor,r="center",a=kn.defaultFont,c="",l=!0,h=void 0,d=$t,u=0,f=jt()){const p=kn.uiContext;d.a>0&&(h&&So(t,e.add(h),i.y,d,s,n,r,a,c,l?i.x:void 0,0,p),(u||f.x||f.y)&&(p.shadowColor=d.toString(),p.shadowBlur=u,p.shadowOffsetX=f.x,p.shadowOffsetY=f.y)),So(t,e,i.y,o,s,n,r,a,c,l?i.x:void 0,0,p),p.shadowColor="#0000"}setupDragAndDrop(t,e,i,o){function s(t,e){document.addEventListener(e,function(e){e.preventDefault(),t&&t(e)})}s(t,"drop"),s(e,"dragenter"),s(i,"dragleave"),s(o,"dragover")}screenToNative(t){if(!kn.nativeHeight)return t;const e=so.y/kn.nativeHeight,i=1/e,o=t.copy();return o.x+=e*so.x/2,o.x*=i,o.y*=i,o.x-=i*so.x/2,o}destroyObjects(){for(const t of this.uiObjects)t.parent||t.destroy();this.uiObjects=this.uiObjects.filter(t=>!t.destroyed),this.activeObject=void 0,this.hoverObject=void 0,this.lastHoverObject=void 0}getNavigableObjects(){function t(i){if(i.visible&&!i.disabled){i.isInteractive()&&void 0!==i.navigationIndex&&e.push(i);for(let e=i.children.length;e--;)t(i.children[e])}}let e=[];for(let e=kn.uiObjects.length;e--;){const i=kn.uiObjects[e];kn.confirmDialog&&i!==kn.confirmDialog||i.parent||t(i)}return e.sort((t,e)=>t.navigationIndex-e.navigationIndex),e}getNavigationDirection(){const t=1===kn.navigationDirection,e=2===kn.navigationDirection;if(jo){const i=this.navigationGamepadIndex,o=is(0,i),s=os(i);return e?-(o.y||s.y)||o.x||s.x:t?-(o.y||s.y):o.x||s.x}const i="ArrowUp",o="ArrowDown",s="ArrowLeft",n="ArrowRight";if(e)return qo(i)||qo(s)?-1:qo(o)||qo(n)?1:0;const r=t?o:n;return qo(t?i:s)?-1:qo(r)?1:0}getNavigationOtherDirection(){if(2===kn.navigationDirection)return 0;const t=1===kn.navigationDirection;if(jo){const e=this.navigationGamepadIndex,i=is(0,e),o=os(e);return t?i.x||o.x:i.y||o.y}const e=t?"ArrowRight":"ArrowDown";return qo(t?"ArrowLeft":"ArrowUp")?-1:qo(e)?1:0}getNavigationWasPressed(){const t=this.navigationGamepadIndex;return jo?ts(0,t):Vo("Space")||Vo("Enter")}showConfirmDialog(t="Are you sure?",e,i,o=jt(500,250),s="Escape"){kn.confirmDialog;const n=kn.navigationDirection;kn.navigationDirection=2;const r=new Kn(jt(),o);kn.confirmDialog=r,r.onRender=()=>{r.pos=kn.screenToNative(so.scale(.5));const t=qt(0,0,0,.7);kn.drawRect(jt(),jt(1e9),t)},r.onUpdate=()=>{Vo(s)&&h()},r.isMouseOverlapping=()=>!0;const a=new Qn(jt(0,-50),jt(o.x-50,70),t);r.addChild(a);const c=new Zn(jt(-80,50),jt(120,70),"Yes");c.textHeight=40,c.navigationIndex=1,c.hoverColor=qt(0,1,.5),c.onClick=()=>{h(),e&&e()},r.addChild(c);const l=new Zn(jt(80,50),jt(120,70),"No");function h(){kn.confirmDialog,r.destroy(),kn.confirmDialog=void 0,kn.navigationDirection=n,Ho()}l.textHeight=40,l.navigationIndex=2,l.navigationAutoSelect=!0,l.onClick=()=>{h(),i&&i()},r.addChild(l)}}class Kn{constructor(t=jt(),e=jt()){kt(t),kt(e),this.localPos=t.copy(),this.pos=t.copy(),this.size=e.copy(),this.color=kn.defaultColor.copy(),this.activeColor=void 0,this.text=void 0,this.disabledColor=kn.defaultDisabledColor.copy(),this.disabled=!1,this.textColor=kn.defaultTextColor.copy(),this.hoverColor=kn.defaultHoverColor.copy(),this.lineColor=kn.defaultLineColor.copy(),this.gradientColor=kn.defaultGradientColor?kn.defaultGradientColor.copy():void 0,this.lineWidth=kn.defaultLineWidth,this.cornerRadius=kn.defaultCornerRadius,this.font=kn.defaultFont,this.fontStyle=void 0,this.textWidth=void 0,this.textHeight=void 0,this.textFitScale=kn.defaultTextFitScale,this.textShadow=void 0,this.textLineColor=kn.defaultLineColor.copy(),this.textLineWidth=0,this.visible=!0,this.children=[],this.parent=void 0,this.extraTouchSize=0,this.soundPress=kn.defaultSoundPress,this.soundRelease=kn.defaultSoundRelease,this.soundClick=kn.defaultSoundClick,this.interactive=!1,this.dragActivate=!1,this.canBeHover=!0,this.shadowColor=kn.defaultShadowColor?.copy(),this.shadowBlur=kn.defaultShadowBlur,this.shadowOffset=kn.defaultShadowOffset?.copy(),this.navigationIndex=void 0,this.navigationAutoSelect=!1,kn.uiObjects.push(this)}addChild(t){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this}removeChild(t){t.parent===this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=void 0}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.parent=0,t.destroy()}}isMouseOverlapping(){if(!Io)return!1;const t=ns?this.size.add(jt(this.extraTouchSize||0)):this.size,e=kn.screenToNative(Fo);return At(this.pos,t,e)}update(){this.onUpdate(),this.disabled&&this==kn.activeObject&&(kn.activeObject=void 0);const t=kn.lastHoverObject===this,e=this.isActiveObject(),i=Ko(0),o=this.dragActivate?i:Qo(0);this.canBeHover&&(kn.navigationMode||(o||e||!i&&!ns)&&!kn.hoverObject&&this.isMouseOverlapping()&&(kn.hoverObject=this)),this.isHoverObject()&&(this.disabled||(o&&this.interactive&&(this.dragActivate&&t&&!Qo(0)||this.onPress(),this.soundPress&&this.soundPress.play(),kn.activeObject&&!e&&kn.activeObject.onRelease(),kn.activeObject=this),!i&&this.isActiveObject()&&this.interactive&&(this.onClick(),this.soundClick&&this.soundClick.play())),o&&Uo(0,0,0,1,0)),e&&(!i||this.dragActivate&&!this.isHoverObject())&&(this.onRelease(),this.soundRelease&&this.soundRelease.play(),kn.activeObject=void 0),this.isHoverObject()!==t&&(this.isHoverObject()?this.onEnter():this.onLeave())}render(){if(this.onRender(),!this.size.x||!this.size.y)return;const t=this.isNavigationObject(),e=t||this.interactive&&this.isActiveObject()&&!this.disabled?this.color:this.lineColor,i=t?this.hoverColor:this.disabled?this.disabledColor:this.interactive?this.isHoverObject()?this.hoverColor:this.isActiveObject()&&this.activeColor||this.color:this.color,o=this.lineWidth*(t?1.5:1);kn.drawRect(this.pos,this.size,i,o,e,this.cornerRadius,this.gradientColor,this.shadowColor,this.shadowBlur,this.shadowOffset)}getTextSize(){return jt(this.textWidth||this.textFitScale*this.size.x,this.textHeight||this.textFitScale*this.size.y)}navigatePressed(){this.onClick(),this.soundClick&&this.soundClick.play()}isHoverObject(){return kn.hoverObject===this}isActiveObject(){return kn.activeObject===this}isNavigationObject(){return kn.navigationObject===this}isInteractive(){return this.interactive&&this.visible&&!this.disabled}toString(){if(!E)return;let t="type = "+this.constructor.name;return this.text&&(t+="\ntext = "+this.text),(this.pos.x||this.pos.y)&&(t+="\npos = "+this.pos),(this.localPos.x||this.localPos.y)&&(t+="localPos = "+this.localPos),(this.size.x||this.size.y)&&(t+="\nsize = "+this.size),this.color&&(t+="\ncolor = "+this.color),t}renderDebug(t=!0){const e=t?this.isHoverObject()?oe:this.disabled?ae:this.interactive?ee:re:se;kn.drawRect(this.pos,this.size,Zt,4,e)}onUpdate(){}onRender(){}onEnter(){}onLeave(){}onPress(){}onRelease(){}onClick(){}onChange(){}}class Qn extends Kn{constructor(t,e,i="",o="center",s=kn.defaultFont){super(t,e),Pt(i),["left","center","right"].includes(o),Pt(s),this.text=i,this.align=o,this.font=s,this.canBeHover=!1,this.color=Zt,this.shadowColor=Zt,this.gradientColor=void 0,this.lineWidth=0,this.textFitScale=1}render(){super.render();const t=this.getTextSize();kn.drawText(this.text,this.pos,t,this.textColor,this.textLineWidth,this.textLineColor,this.align,this.font,this.fontStyle,!0,this.textShadow,this.shadowColor,this.shadowBlur,this.shadowOffset)}}class $n extends Kn{constructor(t,e,i,o=Kt,s=0,n=!1){super(t,e),Vt(o),Et(s),this.tileInfo=i,this.angle=s,this.mirror=n,this.color=o.copy(),this.shadowColor=Zt}render(){kn.drawTile(this.pos,this.size,this.tileInfo,this.color,this.angle,this.mirror,this.shadowColor,this.shadowBlur,this.shadowOffset)}}class Zn extends Kn{constructor(t,e,i="",o=kn.defaultButtonColor){super(t,e),Pt(i),Vt(o),this.textOffset=jt(),this.text=i,this.color=o.copy(),this.interactive=!0}render(){super.render();const t=this.getTextSize();kn.drawText(this.text,this.pos.add(this.textOffset),t,this.textColor,this.textLineWidth,this.textLineColor,this.align,this.font,this.fontStyle,!0,this.textShadow)}}class tr extends Kn{constructor(t,e,i=!1,o="",s=kn.defaultButtonColor){super(t,e),Pt(o),Vt(s),this.checked=i,this.text=o,this.color=s.copy(),this.interactive=!0}onClick(){this.checked=!this.checked,this.onChange()}render(){if(super.render(),this.checked){const t=yt(1,2**.5/2,this.cornerRadius/st(this.size.x,this.size.y)*2)/2;let e=this.size.scale(t);kn.drawLine(this.pos.add(e.multiply(jt(-1))),this.pos.add(e.multiply(jt(1))),this.lineWidth,this.lineColor),kn.drawLine(this.pos.add(e.multiply(jt(-1,1))),this.pos.add(e.multiply(jt(1,-1))),this.lineWidth,this.lineColor)}const t=this.getTextSize(),e=this.pos.add(jt(this.size.x,0));kn.drawText(this.text,e,t,this.textColor,this.textLineWidth,this.textLineColor,"left",this.font,this.fontStyle,!1,this.textShadow)}}class er extends Kn{constructor(t,e,i=.5,o="",s=kn.defaultButtonColor,n=Kt){super(t,e),Et(i),Pt(o),Vt(s),Vt(n),this.value=i,this.handleColor=n.copy(),this.text=o,this.color=s.copy(),this.interactive=!0}update(){if(super.update(),!this.interactive)return;const t=this.value;if(this.isActiveObject()){const t=this.size.x>this.size.y,e=t?this.size.y:this.size.x,i=t?this.size.x:this.size.y,o=t?this.pos.x:this.pos.y,s=i-e,n=o-s/2,r=o+s/2,a=kn.screenToNative(Fo);this.value=t?gt(a.x,n,r):gt(a.y,r,n)}else if(this.isNavigationObject()){const t=kn.getNavigationOtherDirection();kn.navigationTimer.active()||(this.value=pt(this.value+.01*t))}this.value===t||this.onChange()}render(){super.render();const t=this.size.x>this.size.y,e=t?this.size.y:this.size.x,i=t?this.size.x:this.size.y,o=t?this.pos.x:this.pos.y,s=i-e,n=o-s/2,r=o+s/2,a=t?jt(yt(n,r,this.value),this.pos.y):jt(this.pos.x,yt(r,n,this.value)),c=this.disabled?this.disabledColor:this.handleColor;kn.drawRect(a,jt(e),c,this.lineWidth,this.lineColor,this.cornerRadius,this.gradientColor);const l=this.getTextSize();kn.drawText(this.text,this.pos,l,this.textColor,this.textLineWidth,this.textLineColor,this.align,this.font,this.fontStyle,!0,this.textShadow)}navigatePressed(){this.value=this.value?0:1,this.onRelease(),super.navigatePressed()}}class ir extends Kn{constructor(t,e,i,o=!1,s=!1,n=1){super(t,e||jt()),Pt(i),Et(n),this.color=$t,this.cornerRadius=0,this.volume=n,this.video=document.createElement("video"),this.video.loop=s,this.video.volume=pt(n*ii),this.video.muted=!ei,this.video.style.display="none",this.video.src=i,document.body.appendChild(this.video),o&&this.play()}play(){const t=this.video.play();return t?.catch(()=>{}),t}pause(){this.video.pause()}stop(){this.video.pause(),this.video.currentTime=0}isLoading(){return this.video.readyState<this.video.HAVE_CURRENT_DATA}isPaused(){return this.video.paused}isPlaying(){return!this.isPaused()&&!this.hasEnded()&&!this.isLoading()}hasEnded(){return this.video.ended}setVolume(t){this.volume=t,this.video.volume=pt(t*ii)}setPlaybackRate(t){this.video.playbackRate=t}getCurrentTime(){return this.video.currentTime||0}getDuration(){return this.video.duration||0}getVideoSize(){return jt(this.video.videoWidth,this.video.videoHeight)}setTime(t){this.video.currentTime=pt(t,0,this.getDuration())}update(){super.update(),this.video.volume=pt(this.volume*ii)}render(){if(super.render(),this.isLoading())return;const t=kn.uiContext,e=this.size;t.save(),t.translate(this.pos.x,this.pos.y),t.drawImage(this.video,-e.x/2,-e.y/2,e.x,e.y),t.restore()}destroy(){this.destroyed||(this.video.pause(),this.video.remove(),super.destroy())}}let or=!1;function sr(t){or=t}class nr extends eo{constructor(t=jt(),e=jt(),i,o=0,s,n=qn.bodyTypeDynamic,r=0){super(t,e,i,o,s,r);const a=new qn.instance.b2BodyDef;a.set_type(n),a.set_position(qn.vec2dTo(t)),a.set_angle(-o),this.body=qn.world.CreateBody(a),this.body.object=this,this.lineColor=$t,qn.objects.push(this),this.edgeLists=[],this.edgeLoops=[]}destroy(){this.destroyed||(this.body,qn.world.DestroyBody(this.body),super.destroy())}updatePhysics(){}render(){this.tileInfo?super.render():this.drawFixtures(this.color,this.lineColor,this.lineWidth)}renderDebugInfo(){const t=!this.getIsAwake(),e=Ht(t?1:0,t?1:0,this.getBodyType()===qn.bodyTypeStatic?1:0,.5);this.drawFixtures(e)}drawFixtures(t=Kt,e=$t,i=.1,o){this.getFixtureList().forEach(s=>{qn.castObjectType(s.GetShape()).GetType()!==qn.instance.b2Shape.e_edge&&qn.drawFixture(s,this.pos,this.angle,t,e,i,o)}),this.edgeLists.forEach(t=>fo(t,i,e,!1,this.pos,this.angle)),this.edgeLoops.forEach(t=>fo(t,i,e,!0,this.pos,this.angle))}beginContact(t){}endContact(t){}addShape(t,e=1,i=.2,o=0,s=!1){Et(e),Et(i),Et(o);const n=new qn.instance.b2FixtureDef;return n.set_shape(t),n.set_density(e),n.set_friction(i),n.set_restitution(o),n.set_isSensor(s),this.body.CreateFixture(n)}addBox(t=jt(1),e=jt(),i=0,o,s,n,r){kt(t),t.x>0&&t.y,kt(e),Et(i);const a=new qn.instance.b2PolygonShape;return a.SetAsBox(t.x/2,t.y/2,qn.vec2dTo(e),i),this.addShape(a,o,s,n,r)}addPoly(t,e,i,o,s){Gt(t);const n=function(t){3<=t.length&&t.length;const e=new qn.instance.b2PolygonShape,i=function(t){const e=qn.instance._malloc(8*t.length);for(let i=0,o=0;i<t.length;++i)qn.instance.HEAPF32[e+o>>2]=t[i].x,o+=4,qn.instance.HEAPF32[e+o>>2]=t[i].y,o+=4;return qn.instance.wrapPointer(e,qn.instance.b2Vec2)}(t);return e.Set(i,t.length),e}(t);return this.addShape(n,e,i,o,s)}addRegularPoly(t=1,e=8,i,o,s,n){Et(t),Et(e);const r=[],a=t/2;for(let t=e;t--;)r.push(jt(a,0).rotate((t+.5)/e*Z*2));return this.addPoly(r,i,o,s,n)}addRandomPoly(t=1,e,i,o,s){Et(t);const n=Ot(3,9),r=[],a=t/2;for(let t=n;t--;)r.push(jt(Mt(a/2,1.5*a),0).rotate(t/n*Z*2));return this.addPoly(r,e,i,o,s)}addCircle(t=1,e=jt(),i,o,s,n){Et(t),kt(e);const r=new qn.instance.b2CircleShape;return r.set_m_p(qn.vec2dTo(e)),r.set_m_radius(t/2),this.addShape(r,i,o,s,n)}addEdge(t,e,i,o,s,n){kt(t),kt(e);const r=new qn.instance.b2EdgeShape;return r.Set(qn.vec2dTo(t),qn.vec2dTo(e)),this.addShape(r,i,o,s,n)}addEdgeList(t,e,i,o,s){Gt(t);const n=[],r=[];for(let a=0;a<t.length-1;++a){const c=new qn.instance.b2EdgeShape;t[a-1]&&c.set_m_vertex0(qn.vec2dTo(t[a-1])),t[a+0]&&c.set_m_vertex1(qn.vec2dTo(t[a+0])),t[a+1]&&c.set_m_vertex2(qn.vec2dTo(t[a+1])),t[a+2]&&c.set_m_vertex3(qn.vec2dTo(t[a+2]));const l=this.addShape(c,e,i,o,s);n.push(l),r.push(t[a].copy())}return r.push(t[t.length-1].copy()),this.edgeLists.push(r),n}addEdgeLoop(t,e,i,o,s){Gt(t);const n=[],r=[],a=e=>t[ft(e,t.length)];for(let c=0;c<t.length;++c){const l=new qn.instance.b2EdgeShape;l.set_m_vertex0(qn.vec2dTo(a(c-1))),l.set_m_vertex1(qn.vec2dTo(a(c+0))),l.set_m_vertex2(qn.vec2dTo(a(c+1))),l.set_m_vertex3(qn.vec2dTo(a(c+2)));const h=this.addShape(l,e,i,o,s);n.push(h),c<t.length&&r.push(t[c].copy())}return this.edgeLoops.push(r),n}getCenterOfMass(){return qn.vec2From(this.body.GetWorldCenter())}getLinearVelocity(){return qn.vec2From(this.body.GetLinearVelocity())}getAngularVelocity(){return this.body.GetAngularVelocity()}getMass(){return this.body.GetMass()}getInertia(){return this.body.GetInertia()}getIsAwake(){return this.body.IsAwake()}getBodyType(){return this.body.GetType()}getSpeed(){return this.getLinearVelocity().length()}setTransform(t,e){this.pos=t,this.angle=e,this.body.SetTransform(qn.vec2dTo(t),e)}setPosition(t){this.setTransform(t,this.body.GetAngle())}setAngle(t){this.setTransform(qn.vec2From(this.body.GetPosition()),-t)}setLinearVelocity(t){this.body.SetLinearVelocity(qn.vec2dTo(t))}setAngularVelocity(t){this.body.SetAngularVelocity(t)}setLinearDamping(t){this.body.SetLinearDamping(t)}setAngularDamping(t){this.body.SetAngularDamping(t)}setGravityScale(t=1){this.body.SetGravityScale(this.gravityScale=t)}setBullet(t=!0){this.body.SetBullet(t)}setAwake(t=!0){this.body.SetAwake(t)}setBodyType(t){this.body.SetType(t)}setSleepingAllowed(t=!0){this.body.SetSleepingAllowed(t)}setFixedRotation(t=!0){this.body.SetFixedRotation(t)}setCenterOfMass(t){this.setMassData(t)}setMass(t){this.setMassData(void 0,t)}setMomentOfInertia(t){this.setMassData(void 0,void 0,t)}resetMassData(){this.body.ResetMassData()}setMassData(t,e,i){const o=new qn.instance.b2MassData;this.body.GetMassData(o),t&&o.set_center(qn.vec2dTo(t)),e&&o.set_mass(e),i&&o.set_I(i),this.body.SetMassData(o)}setFilterData(t=0,e=0,i=0){this.getFixtureList().forEach(o=>{const s=o.GetFilterData();s.set_categoryBits(t),s.set_maskBits(65535&~e),s.set_groupIndex(i)})}setSensor(t=!0){this.getFixtureList().forEach(e=>e.SetSensor(t))}applyForce(t,e){e||=this.getCenterOfMass(),this.setAwake(),this.body.ApplyForce(qn.vec2dTo(t),qn.vec2dTo(e))}applyAcceleration(t,e){e||=this.getCenterOfMass(),this.setAwake(),this.body.ApplyLinearImpulse(qn.vec2dTo(t),qn.vec2dTo(e))}applyTorque(t){this.setAwake(),this.body.ApplyTorque(t)}applyAngularAcceleration(t){this.setAwake(),this.body.ApplyAngularImpulse(t)}hasFixtures(){return!qn.isNull(this.body.GetFixtureList())}getFixtureList(){const t=[];for(let e=this.body.GetFixtureList();!qn.isNull(e);)t.push(e),e=e.GetNext();return t}hasJoints(){return!qn.isNull(this.body.GetJointList())}getJointList(){const t=[];for(let e=this.body.GetJointList();!qn.isNull(e);)t.push(e),e=e.get_next();return t}}class rr{constructor(t,e,i,o){this.object=t.GetBody().object,this.fixture=t,this.point=e,this.normal=i,this.fraction=o}}class ar{constructor(t){this.box2dJoint=qn.castObjectType(qn.world.CreateJoint(t))}destroy(){qn.world.DestroyJoint(this.box2dJoint),this.box2dJoint=0}getObjectA(){return this.box2dJoint.GetBodyA().object}getObjectB(){return this.box2dJoint.GetBodyB().object}getAnchorA(){return qn.vec2From(this.box2dJoint.GetAnchorA())}getAnchorB(){return qn.vec2From(this.box2dJoint.GetAnchorB())}getReactionForce(t){return qn.vec2From(this.box2dJoint.GetReactionForce(1/t))}getReactionTorque(t){return this.box2dJoint.GetReactionTorque(1/t)}getCollideConnected(){return this.box2dJoint.getCollideConnected()}isActive(){return this.box2dJoint.IsActive()}}class cr extends ar{constructor(t,e,i){t.setAwake();const o=new qn.instance.b2MouseJointDef;o.set_bodyA(e.body),o.set_bodyB(t.body),o.set_target(qn.vec2dTo(i)),o.set_maxForce(2e3*t.getMass()),super(o)}setTarget(t){this.box2dJoint.SetTarget(qn.vec2dTo(t))}getTarget(){return qn.vec2From(this.box2dJoint.GetTarget())}setMaxForce(t){this.box2dJoint.SetMaxForce(t)}getMaxForce(){return this.box2dJoint.GetMaxForce()}setFrequency(t){this.box2dJoint.SetFrequency(t)}getFrequency(){return this.box2dJoint.GetFrequency()}}class lr extends ar{constructor(t,e,i,o,s=!1){i||=qn.vec2From(t.body.GetPosition()),o||=qn.vec2From(e.body.GetPosition());const n=t.worldToLocal(i),r=e.worldToLocal(o),a=new qn.instance.b2DistanceJointDef;a.set_bodyA(t.body),a.set_bodyB(e.body),a.set_localAnchorA(qn.vec2dTo(n)),a.set_localAnchorB(qn.vec2dTo(r)),a.set_length(i.distance(o)),a.set_collideConnected(s),super(a)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}setLength(t){this.box2dJoint.SetLength(t)}getLength(){return this.box2dJoint.GetLength()}setFrequency(t){this.box2dJoint.SetFrequency(t)}getFrequency(){return this.box2dJoint.GetFrequency()}setDampingRatio(t){this.box2dJoint.SetDampingRatio(t)}getDampingRatio(){return this.box2dJoint.GetDampingRatio()}}class hr extends lr{constructor(t,e,i=t.pos,o=!1){super(t,e,void 0,i,o)}}class dr extends ar{constructor(t,e,i,o,s=0,n=!1){i||=qn.vec2From(t.body.GetPosition()),o||=qn.vec2From(e.body.GetPosition());const r=t.worldToLocal(i),a=e.worldToLocal(o),c=new qn.instance.b2RopeJointDef;c.set_bodyA(t.body),c.set_bodyB(e.body),c.set_localAnchorA(qn.vec2dTo(r)),c.set_localAnchorB(qn.vec2dTo(a)),c.set_maxLength(i.distance(o)+s),c.set_collideConnected(n),super(c)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}setMaxLength(t){this.box2dJoint.SetMaxLength(t)}getMaxLength(){return this.box2dJoint.GetMaxLength()}}class ur extends ar{constructor(t,e,i,o=!1){i||=qn.vec2From(e.body.GetPosition());const s=t.worldToLocal(i),n=e.worldToLocal(i),r=new qn.instance.b2RevoluteJointDef;r.set_bodyA(t.body),r.set_bodyB(e.body),r.set_localAnchorA(qn.vec2dTo(s)),r.set_localAnchorB(qn.vec2dTo(n)),r.set_referenceAngle(t.body.GetAngle()-e.body.GetAngle()),r.set_collideConnected(o),super(r)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}getReferenceAngle(){return this.box2dJoint.GetReferenceAngle()}getJointAngle(){return this.box2dJoint.GetJointAngle()}getJointSpeed(){return this.box2dJoint.GetJointSpeed()}isLimitEnabled(){return this.box2dJoint.IsLimitEnabled()}enableLimit(t=!0){return this.box2dJoint.enableLimit(t)}getLowerLimit(){return this.box2dJoint.GetLowerLimit()}getUpperLimit(){return this.box2dJoint.GetUpperLimit()}setLimits(t,e){return this.box2dJoint.SetLimits(t,e)}isMotorEnabled(){return this.box2dJoint.IsMotorEnabled()}enableMotor(t=!0){return this.box2dJoint.EnableMotor(t)}setMotorSpeed(t){return this.box2dJoint.SetMotorSpeed(t)}getMotorSpeed(){return this.box2dJoint.GetMotorSpeed()}setMaxMotorTorque(t){return this.box2dJoint.SetMaxMotorTorque(t)}getMaxMotorTorque(){return this.box2dJoint.GetMaxMotorTorque()}getMotorTorque(t){return this.box2dJoint.GetMotorTorque(1/t)}}class fr extends ar{constructor(t,e,i,o,s=1){const n=new qn.instance.b2GearJointDef;n.set_bodyA(t.body),n.set_bodyB(e.body),n.set_joint1(i.box2dJoint),n.set_joint2(o.box2dJoint),n.set_ratio(s),super(n),this.joint1=i,this.joint2=o}getJoint1(){return this.joint1}getJoint2(){return this.joint2}setRatio(t){return this.box2dJoint.SetRatio(t)}getRatio(){return this.box2dJoint.GetRatio()}}class pr extends ar{constructor(t,e,i,o=jt(0,1),s=!1){i||=qn.vec2From(e.body.GetPosition());const n=t.worldToLocal(i),r=e.worldToLocal(i),a=e.worldToLocalVector(o),c=new qn.instance.b2PrismaticJointDef;c.set_bodyA(t.body),c.set_bodyB(e.body),c.set_localAnchorA(qn.vec2dTo(n)),c.set_localAnchorB(qn.vec2dTo(r)),c.set_localAxisA(qn.vec2dTo(a)),c.set_referenceAngle(t.body.GetAngle()-e.body.GetAngle()),c.set_collideConnected(s),super(c)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}getLocalAxisA(){return qn.vec2From(this.box2dJoint.GetLocalAxisA())}getReferenceAngle(){return this.box2dJoint.GetReferenceAngle()}getJointTranslation(){return this.box2dJoint.GetJointTranslation()}getJointSpeed(){return this.box2dJoint.GetJointSpeed()}isLimitEnabled(){return this.box2dJoint.IsLimitEnabled()}enableLimit(t=!0){return this.box2dJoint.enableLimit(t)}getLowerLimit(){return this.box2dJoint.GetLowerLimit()}getUpperLimit(){return this.box2dJoint.GetUpperLimit()}setLimits(t,e){return this.box2dJoint.SetLimits(t,e)}isMotorEnabled(){return this.box2dJoint.IsMotorEnabled()}enableMotor(t=!0){return this.box2dJoint.EnableMotor(t)}setMotorSpeed(t){return this.box2dJoint.SetMotorSpeed(t)}getMotorSpeed(){return this.box2dJoint.GetMotorSpeed()}setMaxMotorForce(t){return this.box2dJoint.SetMaxMotorForce(t)}getMaxMotorForce(){return this.box2dJoint.GetMaxMotorForce()}getMotorForce(t){return this.box2dJoint.GetMotorForce(1/t)}}class gr extends nr{constructor(t,e,i,o=0,s,n=0){super(t,e,i,o,s,qn.bodyTypeStatic,n)}}class yr extends nr{constructor(t,e,i,o=0,s,n=0){super(t,e,i,o,s,qn.bodyTypeKinematic,n)}}class vr extends ar{constructor(t,e,i,o=jt(0,1),s=!1){i||=qn.vec2From(e.body.GetPosition());const n=t.worldToLocal(i),r=e.worldToLocal(i),a=e.worldToLocalVector(o),c=new qn.instance.b2WheelJointDef;c.set_bodyA(t.body),c.set_bodyB(e.body),c.set_localAnchorA(qn.vec2dTo(n)),c.set_localAnchorB(qn.vec2dTo(r)),c.set_localAxisA(qn.vec2dTo(a)),c.set_collideConnected(s),super(c)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}getLocalAxisA(){return qn.vec2From(this.box2dJoint.GetLocalAxisA())}getJointTranslation(){return this.box2dJoint.GetJointTranslation()}getJointSpeed(){return this.box2dJoint.GetJointSpeed()}isMotorEnabled(){return this.box2dJoint.IsMotorEnabled()}enableMotor(t=!0){return this.box2dJoint.EnableMotor(t)}setMotorSpeed(t){return this.box2dJoint.SetMotorSpeed(t)}getMotorSpeed(){return this.box2dJoint.GetMotorSpeed()}setMaxMotorTorque(t){return this.box2dJoint.SetMaxMotorTorque(t)}getMaxMotorTorque(){return this.box2dJoint.GetMaxMotorTorque()}getMotorTorque(t){return this.box2dJoint.GetMotorTorque(1/t)}setSpringFrequencyHz(t){return this.box2dJoint.SetSpringFrequencyHz(t)}getSpringFrequencyHz(){return this.box2dJoint.GetSpringFrequencyHz()}setSpringDampingRatio(t){return this.box2dJoint.SetSpringDampingRatio(t)}getSpringDampingRatio(){return this.box2dJoint.GetSpringDampingRatio()}}class xr extends ar{constructor(t,e,i,o=!1){i||=qn.vec2From(e.body.GetPosition());const s=t.worldToLocal(i),n=e.worldToLocal(i),r=new qn.instance.b2WeldJointDef;r.set_bodyA(t.body),r.set_bodyB(e.body),r.set_localAnchorA(qn.vec2dTo(s)),r.set_localAnchorB(qn.vec2dTo(n)),r.set_referenceAngle(t.body.GetAngle()-e.body.GetAngle()),r.set_collideConnected(o),super(r)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}getReferenceAngle(){return this.box2dJoint.GetReferenceAngle()}setFrequency(t){return this.box2dJoint.SetFrequency(t)}getFrequency(){return this.box2dJoint.GetFrequency()}setSpringDampingRatio(t){return this.box2dJoint.SetSpringDampingRatio(t)}getSpringDampingRatio(){return this.box2dJoint.GetSpringDampingRatio()}}class br extends ar{constructor(t,e,i,o=!1){i||=qn.vec2From(e.body.GetPosition());const s=t.worldToLocal(i),n=e.worldToLocal(i),r=new qn.instance.b2FrictionJointDef;r.set_bodyA(t.body),r.set_bodyB(e.body),r.set_localAnchorA(qn.vec2dTo(s)),r.set_localAnchorB(qn.vec2dTo(n)),r.set_collideConnected(o),super(r)}getLocalAnchorA(){return qn.vec2From(this.box2dJoint.GetLocalAnchorA())}getLocalAnchorB(){return qn.vec2From(this.box2dJoint.GetLocalAnchorB())}setMaxForce(t){this.box2dJoint.SetMaxForce(t)}getMaxForce(){return this.box2dJoint.GetMaxForce()}setMaxTorque(t){this.box2dJoint.SetMaxTorque(t)}getMaxTorque(){return this.box2dJoint.GetMaxTorque()}}class mr extends ar{constructor(t,e,i,o,s,n,r=1,a=!1){s||=qn.vec2From(t.body.GetPosition()),n||=qn.vec2From(e.body.GetPosition());const c=t.worldToLocal(s),l=e.worldToLocal(n),h=new qn.instance.b2PulleyJointDef;h.set_bodyA(t.body),h.set_bodyB(e.body),h.set_groundAnchorA(qn.vec2dTo(i)),h.set_groundAnchorB(qn.vec2dTo(o)),h.set_localAnchorA(qn.vec2dTo(c)),h.set_localAnchorB(qn.vec2dTo(l)),h.set_ratio(r),h.set_lengthA(i.distance(s)),h.set_lengthB(o.distance(n)),h.set_collideConnected(a),super(h)}getGroundAnchorA(){return qn.vec2From(this.box2dJoint.GetGroundAnchorA())}getGroundAnchorB(){return qn.vec2From(this.box2dJoint.GetGroundAnchorB())}getLengthA(){return this.box2dJoint.GetLengthA()}getLengthB(){return this.box2dJoint.GetLengthB()}getRatio(){return this.box2dJoint.GetRatio()}getCurrentLengthA(){return this.box2dJoint.GetCurrentLengthA()}getCurrentLengthB(){return this.box2dJoint.GetCurrentLengthB()}}class Sr extends ar{constructor(t,e){const i=t.worldToLocal(qn.vec2From(e.body.GetPosition())),o=e.body.GetAngle()-t.body.GetAngle(),s=new qn.instance.b2MotorJointDef;s.set_bodyA(t.body),s.set_bodyB(e.body),s.set_linearOffset(qn.vec2dTo(i)),s.set_angularOffset(o),super(s)}setLinearOffset(t){this.box2dJoint.SetLinearOffset(qn.vec2dTo(t))}getLinearOffset(){return qn.vec2From(this.box2dJoint.GetLinearOffset())}setAngularOffset(t){this.box2dJoint.SetAngularOffset(t)}getAngularOffset(){return this.box2dJoint.GetAngularOffset()}setMaxForce(t){this.box2dJoint.SetMaxForce(t)}getMaxForce(){return this.box2dJoint.GetMaxForce()}setMaxTorque(t){this.box2dJoint.SetMaxTorque(t)}getMaxTorque(){return this.box2dJoint.GetMaxTorque()}setCorrectionFactor(t){this.box2dJoint.SetCorrectionFactor(t)}getCorrectionFactor(){return this.box2dJoint.GetCorrectionFactor()}}class wr{constructor(t){qn=this,this.instance=t,this.world=new qn.instance.b2World,this.objects=[],this.velocityIterations=8,this.positionIterations=3,this.bodyTypeStatic=t.b2_staticBody,this.bodyTypeKinematic=t.b2_kinematicBody,this.bodyTypeDynamic=t.b2_dynamicBody;const e=new qn.instance.JSContactListener;e.BeginContact=function(t){const e=qn.instance.wrapPointer(t,qn.instance.b2Contact),i=e.GetFixtureA(),o=e.GetFixtureB(),s=i.GetBody().object,n=o.GetBody().object;s.beginContact(n),n.beginContact(s)},e.EndContact=function(t){const e=qn.instance.wrapPointer(t,qn.instance.b2Contact),i=e.GetFixtureA(),o=e.GetFixtureB(),s=i.GetBody().object,n=o.GetBody().object;s.endContact(n),n.endContact(s)},e.PreSolve=function(){},e.PostSolve=function(){},qn.world.SetContactListener(e)}step(t=1){qn.world.SetGravity(qn.vec2dTo(We));for(let e=t;e--;)qn.world.Step(r,this.velocityIterations,this.positionIterations)}raycastAll(t,e){const i=new qn.instance.JSRayCastCallback;i.ReportFixture=function(t,e,i,s){const n=qn.instance.wrapPointer(t,qn.instance.b2Fixture);return e=qn.vec2FromPointer(e),i=qn.vec2FromPointer(i),o.push(new rr(n,e,i,s)),1};const o=[];return qn.world.RayCast(i,qn.vec2dTo(t),qn.vec2dTo(e)),M&&o.length,o}raycast(t,e){const i=qn.raycastAll(t,e);if(i.length)return i.reduce((t,e)=>t.fraction<e.fraction?t:e)}boxCastAll(t,e){const i=new qn.instance.JSQueryCallback;i.ReportFixture=function(t){const e=qn.instance.wrapPointer(t,qn.instance.b2Fixture).GetBody().object;return s.includes(e)||s.push(e),!0};const o=new qn.instance.b2AABB;o.set_lowerBound(qn.vec2dTo(t.subtract(e.scale(.5)))),o.set_upperBound(qn.vec2dTo(t.add(e.scale(.5))));let s=[];return qn.world.QueryAABB(i,o),M&&s.length,s}boxCast(t,e){const i=new qn.instance.JSQueryCallback;i.ReportFixture=function(t){const e=qn.instance.wrapPointer(t,qn.instance.b2Fixture);return s=e.GetBody().object,!1};const o=new qn.instance.b2AABB;let s;return o.set_lowerBound(qn.vec2dTo(t.subtract(e.scale(.5)))),o.set_upperBound(qn.vec2dTo(t.add(e.scale(.5)))),qn.world.QueryAABB(i,o),s}circleCastAll(t,e){const i=(e/2)**2;return qn.boxCastAll(t,jt(e)).filter(e=>e.pos.distanceSquared(t)<i)}circleCast(t,e){const i=(e/2)**2;let o,s,n=qn.boxCastAll(t,jt(e));for(const e of n){const n=e.pos.distanceSquared(t);n<i&&(!o||n<s)&&(o=e,s=n)}return o}pointCast(t,e=!0){const i=new qn.instance.JSQueryCallback;i.ReportFixture=function(i){const o=qn.instance.wrapPointer(i,qn.instance.b2Fixture);return!(!e||o.GetBody().GetType()===qn.instance.b2_dynamicBody)||!o.TestPoint(qn.vec2dTo(t))||(s=o.GetBody().object,!1)};const o=new qn.instance.b2AABB;let s;return o.set_lowerBound(qn.vec2dTo(t)),o.set_upperBound(qn.vec2dTo(t)),qn.world.QueryAABB(i,o),M&&jt(),s}drawFixture(t,e,i,o=Kt,s=$t,n=.1,r){const a=qn.castObjectType(t.GetShape());switch(a.GetType()){case qn.instance.b2Shape.e_polygon:{let t=[];for(let e=a.GetVertexCount();e--;)t.push(qn.vec2From(a.GetVertex(e)));go(t,o,n,s,e,i);break}case qn.instance.b2Shape.e_circle:vo(e,2*a.get_m_radius(),o,n,s);break;case qn.instance.b2Shape.e_edge:po(qn.vec2From(a.get_m_vertex1()),qn.vec2From(a.get_m_vertex2()),n,s,e,i)}}vec2From(t){return qn.instance.b2Vec2,new Ut(t.get_x(),t.get_y())}vec2FromPointer(t){const e=qn.instance.wrapPointer(t,qn.instance.b2Vec2);return qn.vec2From(e)}vec2dTo(t){return kt(t),new qn.instance.b2Vec2(t.x,t.y)}isNull(t){return!qn.instance.getPointer(t)}castObjectType(t){switch(t.GetType()){case qn.instance.b2Shape.e_circle:return qn.instance.castObject(t,qn.instance.b2CircleShape);case qn.instance.b2Shape.e_edge:return qn.instance.castObject(t,qn.instance.b2EdgeShape);case qn.instance.b2Shape.e_polygon:return qn.instance.castObject(t,qn.instance.b2PolygonShape);case qn.instance.b2Shape.e_chain:return qn.instance.castObject(t,qn.instance.b2ChainShape);case qn.instance.e_revoluteJoint:return qn.instance.castObject(t,qn.instance.b2RevoluteJoint);case qn.instance.e_prismaticJoint:return qn.instance.castObject(t,qn.instance.b2PrismaticJoint);case qn.instance.e_distanceJoint:return qn.instance.castObject(t,qn.instance.b2DistanceJoint);case qn.instance.e_pulleyJoint:return qn.instance.castObject(t,qn.instance.b2PulleyJoint);case qn.instance.e_mouseJoint:return qn.instance.castObject(t,qn.instance.b2MouseJoint);case qn.instance.e_gearJoint:return qn.instance.castObject(t,qn.instance.b2GearJoint);case qn.instance.e_wheelJoint:return qn.instance.castObject(t,qn.instance.b2WheelJoint);case qn.instance.e_weldJoint:return qn.instance.castObject(t,qn.instance.b2WeldJoint);case qn.instance.e_frictionJoint:return qn.instance.castObject(t,qn.instance.b2FrictionJoint);case qn.instance.e_ropeJoint:return qn.instance.castObject(t,qn.instance.b2RopeJoint);case qn.instance.e_motorJoint:return qn.instance.castObject(t,qn.instance.b2MotorJoint)}}}async function Tr(){return new wr(await Box2D()),function(){const t=.1,e=new qn.instance.JSDraw,i=t=>{return(e=t,(t=>new Xt(t.get_r(),t.get_g(),t.get_b()))(qn.instance.wrapPointer(e,qn.instance.b2Color))).scale(1,.8);var e},o=(t,e)=>{const i=[];for(let o=e;o--;)i.push(qn.vec2FromPointer(t+8*o));return i};e.DrawSegment=function(e,o,s){s=i(s),po(e=qn.vec2FromPointer(e),o=qn.vec2FromPointer(o),t,s,jt(),0,!1,!1,fe)},e.DrawPolygon=function(e,s,n){n=i(n),go(o(e,s),Qt,t,n,jt(),0,!1,!1,fe)},e.DrawSolidPolygon=function(t,e,s){s=i(s),go(o(t,e),s,0,s,jt(),0,!1,!1,fe)},e.DrawCircle=function(e,o,s){s=i(s),vo(e=qn.vec2FromPointer(e),2*o,Qt,t,s,!1,!1,fe)},e.DrawSolidCircle=function(e,o,s,n){n=i(n),e=qn.vec2FromPointer(e),s=qn.vec2FromPointer(s).scale(o),vo(e,2*o,n,t,n,!1,!1,fe),po(jt(),s,t,n,e,0,!1,!1,fe)},e.DrawTransform=function(e){const i=jt((e=qn.instance.wrapPointer(e,qn.instance.b2Transform)).get_p()),o=-e.get_q().GetAngle(),s=jt(1,0),n=Ht(.75,0,0,.8),r=jt(0,1),a=Ht(0,.75,0,.8);po(jt(),s,t,n,i,o,!1,!1,fe),po(jt(),r,t,a,i,o,!1,!1,fe)},e.AppendFlags(qn.instance.b2Draw.e_shapeBit),e.AppendFlags(qn.instance.b2Draw.e_jointBit),qn.world.SetDebugDraw(e)}(),m(function(){if(!u){qn.step(),qn.objects=qn.objects.filter(t=>!t.destroyed);for(const t of qn.objects)t.body&&(t.pos=qn.vec2From(t.body.GetPosition()),t.angle=-t.body.GetAngle())}},function(){(or||G)&&qn.world.DrawDebugData()}),qn}function Ar(t,e,i,o=32,s=2,n=0){Cr(t,e,i,Kt,o,$t,s,n,!1,!0,fe)}function Cr(t,e,i,o,s=1,n,r=.05,a=0,c=Ge,l,h){const d=i.offset(i.size),u=e.add(jt(r-2*s)),f=jt(s),p=e.scale(.5).subtract(f.scale(.5)),g=l?-1:1,y=l?-a:a;lo(t,u,d,o,a,!1,n,c,l,h);for(let e=4;e--;){const r=e%2,f=p.multiply(jt(r?1===e?1:-1:0,r?0:e?-1:1)),v=jt(r?s:u.x,r?u.y:s),x=d.offset(i.size.multiply(jt(1===e?1:3===e?-1:0,0===e?-g:2===e?g:0)));lo(t.add(f.rotate(y)),v,x,o,a,!1,n,c,l,h)}for(let e=4;e--;){const s=e>1,r=e&&e<3,u=p.multiply(jt(s?-1:1,r?-1:1)),v=d.offset(i.size.multiply(jt(s?-1:1,r?g:-g)));lo(t.add(u.rotate(y)),f,v,o,a,!1,n,c,l,h)}}function Lr(t,e,i,o=32,s=2,n=0){Dr(t,e,i,Kt,o,$t,s,n,!1,!0,fe)}function Dr(t,e,i,o,s=1,n,r=.05,a=0,c=Ge,l,h){const d=i.frame(0),u=i.frame(1),f=i.frame(2),p=e.add(jt(r-2*s)),g=jt(s),y=e.scale(.5).subtract(g.scale(.5)),v=l?-1:1,x=l?-a:a;lo(t,p,f,o,a,!1,n,c,l,h);for(let e=4;e--;){const i=a+e*Z/2,r=e%2,d=y.multiply(jt(r?1===e?1:-1:0,r?0:e?-v:v)),f=jt(r?p.y:p.x,s);lo(t.add(d.rotate(x)),f,u,o,i,!1,n,c,l,h)}for(let e=4;e--;){const i=a+e*Z/2,s=!e||e>2,r=e>1,u=y.multiply(jt(s?-1:1,r?-v:v));lo(t.add(u.rotate(x)),g,d,o,i,!1,n,c,l,h)}}},586:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e,i,o){this.position=t,this.fromRoom=e,this.toRoom=i,this.cardinalDirection=o}},709:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var o,s=i(583);!function(t){t.gvec2=function(t){return s.vec2(t.x,-t.y)}}(o||(o={})),e.default=o},790:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=i(583),s=i(709).default.gvec2,n=function(){function t(t,e,i,s){void 0===i&&(i=o.vec2(2)),void 0===s&&(s=o.vec2(0,0)),this.tileId=t,this.position=s,this.tileSize=e,this.scale=i,this.gPosition=s}return t.prototype.move=function(t){this.position=this.position.add(t),this.gPosition=this.position.add(s(t))},t.prototype.render=function(t){void 0===t&&(t=this.scale),o.drawTile(this.position,t,o.tile(this.tileId,this.tileSize))},t}();e.default=n}},s={};function n(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={exports:{}};return o[t](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var o=i.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=i[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),t=n(583),e=n(106),i=new(n(120).default)(800,600,16,t.vec2(1,1),[e.default],48,21),t.engineInit(function(){i.init()},function(){i.update()},function(){},function(){i.render()},function(){i.renderPost()},i.tiles)})();
//# sourceMappingURL=app.bundle.js.map